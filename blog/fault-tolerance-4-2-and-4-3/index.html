<!DOCTYPE html>
<html>

<head>
  <title>Fault Tolerance 4.2 &amp; 4.3</title>
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlightjs-pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV="Content-Security-Policy" CONTENT="default-src 'none'; script-src 'self' www.redhat.com assets.adobedtm.com jsonip.com ajax.googleapis.com www.googletagmanager.com www.google-analytics.com use.fontawesome.com; style-src 'self'  fonts.googleapis.com use.fontawesome.com; img-src 'self' *; media-src 'self' ; frame-src www.googletagmanager.com; frame-ancestors 'none'; base-uri 'none'; object-src 'none'; form-action 'none'; font-src 'self' use.fontawesome.com fonts.gstatic.com;">
  <META HTTP-EQUIV="X-Frame-Options" CONTENT="DENY">
  <META HTTP-EQUIV="X-XSS-Protection" CONTENT="1; mode=block">
  <META HTTP-EQUIV="X-Content-Type-Options" CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="SmallRye is a project to share and collaborate on implementing specifications that are part of Eclipse MicroProfile.">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
</head>

<body class="post">

  <div class="content">
    <div class="navigation-wrapper">
  <div class="width-12-12">
    <div class="header navigation">
      <div class="logo-wrapper">
        <a href="/"><img class="project-logo" title="SmallRye" src="/assets/images/smallrye_project_logo.svg"></a>
      </div>
      <div class="nav-container">
        <nav>
          <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
          <ul class="nav-list">
            <li>
              <a href="/projects/" class="">Projects</a>
            </li>
            <li>
              <a href="/community/" class="">Community</a>
            </li>
            <li>
              <a href="/blog/" class="active">Blog</a>
            </li>
            <li>
              <a href="/docs/index.html" class="">Documentation</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>

    <div class="post-page grid-wrapper">
  <div class="grid__item width-10-12 doc-content">
    <h1>Fault Tolerance 4.2 &amp; 4.3</h1>
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Today, we announce two new releases of SmallRye Fault Tolerance: 4.2.1 and 4.3.0.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="4_2_1">4.2.1</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This release includes bugfixes and component updates and is safe to use for everyone who uses Fault Tolerance 4.1.0, 4.1.1 and 4.2.0.
The 4.2.0 release happened a few weeks ago and didn&#8217;t contain anything but bugfixes.
With 4.2.1, we now use MicroProfile Fault Tolerance 2.1.1, which includes some TCK fixes.</p>
</div>
<div class="paragraph">
<p>There is one small feature in the 4.2.1 release, which is interesting for integrators.
If you integrate SmallRye Fault Tolerance and provide your own <code>ExecutorFactory</code>, you can now inherit from the <code>DefaultExecutorFactory</code> class and override the <code>threadFactory</code> method.
This allows customizing the most important property: how do the thread pools create their threads.
All the other thread pool settings will stay at the SmallRye Fault Tolerance defaults.
Of course, you can still provide a your own <code>ExecutorFactory</code> and customize everything.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="4_3_0">4.3.0</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This release builds on 4.2.1 and adds one new feature: you can now observe when circuit breakers change their state.
Let&#8217;s first take a look at the code.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say we have a method <code>doWork</code> which is guarded by a circuit breaker, presumably because it reaches out to some external service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@ApplicationScoped
public class MyService {
    @CircuitBreaker(...)
    public void doWork() {
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, there are metrics for how often the circuit breaker trips etc., but you might want to observe when the circuit breaker state changes directly.
With SmallRye Fault Tolerance 4.3.0, that is now possible: circuit breaker state changes are emitted as CDI events.
With an event observer, it&#8217;s easy to react to circuit breaker state changing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@ApplicationScoped
public class MyServiceObserver {
    public void onStateChange(@Observes CircuitBreakerStateChanged event) {
        if (MyService.class.equals(event.clazz) &amp;&amp; "doWork".equals(event.method.getName())) {
            System.out.println("!!! circuit breaker is now " + event.targetState);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in this example, we make one simplifying assumption: that the <code>MyService</code> class only has <em>one</em> method called <code>doWork</code>.
If it had multiple <code>doWork</code> methods, each having different signature and each having its own circuit breaker, we would have to distinguish between them in the observer.</p>
</div>
<div class="paragraph">
<p>The <code>CircuitBreakerStateChanged</code> event type includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the bean <code>clazz</code>, as <code>java.lang.Class</code>;</p>
</li>
<li>
<p>the guarded <code>method</code>, as <code>java.lang.reflect.Method</code>;</p>
</li>
<li>
<p>the <code>targetState</code> of the circuit breaker, as a simple enum <code>CircuitBreakerState</code> with 3 values: <code>CLOSED</code>, <code>OPEN</code> and <code>HALF_OPEN</code>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="experimental_api">Experimental API</h3>
<div class="paragraph">
<p>The <code>CircuitBreakerStateChanged</code> and <code>CircuitBreakerState</code> classes are meant for direct consumption by end users.
They are considered an experimental API, because we&#8217;re trying to find out how to best provide this feature.
This also means that breaking changes are very much possible, when we learn how to improve the API.
Your feedback is very important here!</p>
</div>
<div class="paragraph">
<p>If you use a runtime such as Thorntail or Quarkus, they should provide you the correct dependency automatically, after they update to SmallRye Fault Tolerance 4.3.0. If you use SmallRye Fault Tolerance directly, you should note that these classes are located in a new artifact: <code>smallrye-fault-tolerance-api</code>.</p>
</div>
</div>
</div>
</div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/smallrye_project_logo.svg" class="project-logo" title="SmallRye"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">SmallRye is open source under <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>. <br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/smallrye/smallrye.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="/">Home</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Contribute</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://twitter.com/smallrye_io">Follow us</a></li>
          
            <li><a href="https://github.com/smallrye">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://gitter.im/smallrye-io/community">Chatroom</a></li>
          
            <li><a href="https://groups.google.com/d/forum/smallrye">Google&nbsp;Groups</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-6-12 more-links">
        <span>External Links</span>
        <ul class="footer-links">
          
            <li><a href="https://microprofile.io/" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://github.com/eclipse?utf8=✓&q=microprofile" target="_blank">Eclipse MicroProfile on GitHub</a></li>
          
        </ul>
      </div>
    
  </div>
</div>
  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a>
      | <a href="https://www.redhat.com/en/about/privacy-policy">Red Hat Privacy Policy</a>
    </span>
    <span class="redhat">
      a Red Hat sponsored project   
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script type="text/javascript" src="/assets/javascript/satellite.js"></script>
</body>

</html>
