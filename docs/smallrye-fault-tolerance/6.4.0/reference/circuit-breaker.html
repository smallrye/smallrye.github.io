<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Circuit Breaker :: SmallRye documentation</title>
    <link rel="prev" href="bulkhead.html">
    <link rel="next" href="timeout.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <button class="nav-toggle"></button>

      <a class="navbar-item title" href="../index.html">SmallRye Fault Tolerance</a>

      <div class="navbar-item has-dropdown is-hoverable">
        <span class="navbar-link">6.4.0</span>
        <div class="navbar-dropdown navbar-menu">
            <a class="navbar-item " href="../../6.9.0/index.html">6.9.0</a>
            <a class="navbar-item " href="../../6.8.0/index.html">6.8.0</a>
            <a class="navbar-item " href="../../6.7.3/index.html">6.7.3</a>
            <a class="navbar-item " href="../../6.7.2/index.html">6.7.2</a>
            <a class="navbar-item " href="../../6.7.1/index.html">6.7.1</a>
            <a class="navbar-item " href="../../6.7.0/index.html">6.7.0</a>
            <a class="navbar-item " href="../../6.6.3/index.html">6.6.3</a>
            <a class="navbar-item " href="../../6.6.2/index.html">6.6.2</a>
            <a class="navbar-item " href="../../6.6.1/index.html">6.6.1</a>
            <a class="navbar-item " href="../../6.6.0/index.html">6.6.0</a>
            <a class="navbar-item " href="../../6.5.0/index.html">6.5.0</a>
            <a class="navbar-item " href="../../6.4.2/index.html">6.4.2</a>
            <a class="navbar-item " href="../../6.4.1/index.html">6.4.1</a>
            <a class="navbar-item  is-current" href="../index.html">6.4.0</a>
            <a class="navbar-item " href="../../6.3.0/index.html">6.3.0</a>
            <a class="navbar-item " href="../../6.2.6/index.html">6.2.6</a>
            <a class="navbar-item " href="../../6.2.4/index.html">6.2.4</a>
            <a class="navbar-item " href="../../6.2.3/index.html">6.2.3</a>
            <a class="navbar-item " href="../../6.2.2/index.html">6.2.2</a>
            <a class="navbar-item " href="../../6.2.1/index.html">6.2.1</a>
            <a class="navbar-item " href="../../6.2.0/index.html">6.2.0</a>
            <a class="navbar-item " href="../../6.1.0/index.html">6.1.0</a>
            <a class="navbar-item " href="../../6.0.0/index.html">6.0.0</a>
            <a class="navbar-item " href="../../5.6.0/index.html">5.6.0</a>
            <a class="navbar-item " href="../../5.5.0/index.html">5.5.0</a>
            <a class="navbar-item " href="../../5.4.1/index.html">5.4.1</a>
            <a class="navbar-item " href="../../5.4.0/index.html">5.4.0</a>
            <a class="navbar-item " href="../../5.3.2/index.html">5.3.2</a>
            <a class="navbar-item " href="../../5.3.1/index.html">5.3.1</a>
            <a class="navbar-item " href="../../5.3.0/index.html">5.3.0</a>
            <a class="navbar-item " href="../../5.2.1/index.html">5.2.1</a>
            <a class="navbar-item " href="../../5.2.0/index.html">5.2.0</a>
            <a class="navbar-item " href="../../5.1.0/index.html">5.1.0</a>
            <a class="navbar-item " href="../../5.0.0/index.html">5.0.0</a>
        </div>
      </div>


      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>

    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <span class="navbar-link">Projects</span>
          <div class="navbar-dropdown">
              <a class="navbar-item" href="../../../index/index/index.html">Index</a>
              <a class="navbar-item" href="../../6.9.0/index.html">SmallRye Fault Tolerance</a>
              <a class="navbar-item" href="../../../smallrye-health/3.0.1/index.html">SmallRye Health</a>
              <a class="navbar-item" href="../../../smallrye-jwt/index.html">SmallRye JWT</a>
              <a class="navbar-item" href="../../../smallrye-metrics/3.0.0/index.html">SmallRye Metrics</a>
          </div>
        </div>

        <a class="navbar-item" href="https://smallrye.io/">SmallRye.io main website</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="smallrye-fault-tolerance" data-version="6.4.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list nav-list-level-0">
  <li class="nav-item nav-item-level-0">
<ul class="nav-list nav-list-level-1">
  <li class="nav-item nav-item-level-1">
    <a class="nav-link" href="../index.html">Index</a>
  </li>
  <li class="nav-item nav-item-level-1">
    <span class="nav-text">How-to &#8230;&#8203;</span>
<ul class="nav-list nav-list-level-2">
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../howto/begin.html">Begin</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../howto/fallback.html">Supply Fallback Values</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../howto/bulkhead.html">Limit Concurrency</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../howto/circuit-breaker.html">Fail Fast on Recurring Failures</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../howto/timeout.html">Watch for Timeouts</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../howto/retry.html">Retry on Failures</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../howto/asynchronous.html">Guard Asynchronous Methods</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../howto/rate-limit.html">Limit Execution Rate</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../howto/multiple.html">Use Multiple Strategies</a>
  </li>
</ul>
  </li>
  <li class="nav-item nav-item-level-1">
    <span class="nav-text">Reference</span>
<ul class="nav-list nav-list-level-2">
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="fallback.html">Fallback</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="bulkhead.html">Bulkhead</a>
  </li>
  <li class="nav-item nav-item-level-2 is-current-page">
    <a class="nav-link" href="circuit-breaker.html">Circuit Breaker</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="timeout.html">Timeout</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="retry.html">Retry</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="asynchronous.html">Asynchronous Execution</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="rate-limit.html">Rate Limit</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="config.html">Configuration</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="metrics.html">Metrics</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="non-compat.html">Non-compatible Mode</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="programmatic-api.html">Programmatic API</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="reusable.html">Reusable Fault Tolerance</a>
  </li>
</ul>
  </li>
  <li class="nav-item nav-item-level-1">
    <span class="nav-text">Integration</span>
<ul class="nav-list nav-list-level-2">
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../integration/intro.html">Introduction</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../integration/metrics.html">Metrics</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../integration/thread-pool.html">Thread Pool</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../integration/context-propagation.html">Context Propagation</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../integration/opentracing.html">OpenTracing</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../integration/event-loop.html">Event Loop</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../integration/async-types.html">Additional Asynchronous Types Integration Concerns</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../integration/kotlin.html">Kotlin Integration Concerns</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../integration/programmatic-api.html">Programmatic API Integration Concerns</a>
  </li>
</ul>
  </li>
  <li class="nav-item nav-item-level-1">
    <span class="nav-text">Internals</span>
<ul class="nav-list nav-list-level-2">
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../internals/project-structure.html">Project Structure</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../internals/instructions.html">Instructions</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../internals/core.html">Fault Tolerance Core</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../internals/config.html">Configuration System</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../internals/logging.html">Logging</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
  <div class="content">
<aside class="toc sidebar" data-title="Table of contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
  <a href="https://github.com/smallrye/smallrye-fault-tolerance/blob/6.4.0/doc/modules/ROOT/pages/reference/circuit-breaker.adoc" class="edit-this-page" title="Edit this page">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>
<h1 class="page">Circuit Breaker</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>For introduction, see <a href="../howto/circuit-breaker.html" class="page">How to Fail Fast on Recurring Failures</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_description"><a class="anchor" href="#_description"></a>Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The circuit breaker is a simple state machine:</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="../_images/circuit-breaker-d4de8eed326379e7fdfe50126a827e4a7d0db05a.svg" alt="circuit-breaker">
</div>
</div>
<div class="paragraph">
<p>The circuit breaker starts <em>closed</em>.
In this state, the circuit breaker maintains a rolling window of recent invocations.
For each invocation, the rolling window tracks whether it finished successfully or failed.</p>
</div>
<div class="paragraph">
<p>The rolling window must be full to take any state transition decision.
For example, if the rolling window has size 10, a closed circuit breaker always allows at least 10 invocations.</p>
</div>
<div class="paragraph">
<p>If the rolling window contains a number of failures higher than the configured ratio, a closed circuit breaker moves to <em>open</em>.
When the circuit breaker is open, invocations are not allowed to proceed.
Instead, the circuit breaker fails fast and throws <code>CircuitBreakerOpenException</code>.</p>
</div>
<div class="paragraph">
<p>For example, if the rolling window has size 10 and the failure rate is 0.5, it means that 5 invocations out of the most recent 10 invocations must fail for the circuit breaker to move to <em>open</em>.</p>
</div>
<div class="paragraph">
<p>After some time, an open circuit breaker moves to <em>half-open</em> to determine whether failing fast is still appropriate.
A half-open circuit breaker allows some configured number of probe attempts to proceed.
If all of them succeed, the circuit breaker moves to <em>closed</em> and invocations are allowed again.
If some probe invocations fail, the circuit breaker moves back to <em>open</em> and invocations are prevented.</p>
</div>
<div class="paragraph">
<p>Successes and failures are determined from the method result.
More specifically:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the guarded method returns normally, it is treated as success.</p>
</li>
<li>
<p>Otherwise, if the guarded method throws an exception whose type is assignable to any of the <code>skipOn</code> types (see <a href="#skip-on">skipOn</a>), it is treated as success.</p>
</li>
<li>
<p>Otherwise, if the guarded method throws an exception whose type is assignable to any of the <code>failOn</code> types (see <a href="#fail-on">failOn</a>), it is treated as failure.</p>
</li>
<li>
<p>Otherwise, it is treated as success.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_lifecycle"><a class="anchor" href="#_lifecycle"></a>Lifecycle</h3>
<div class="paragraph">
<p>Circuit breaker needs to maintain some state between invocations: the number of recent successful invocations, the number of recent failed invocations, and so on.
This state is a singleton, irrespective of the lifecycle of the bean that uses the <code>@CircuitBreaker</code> annotation.</p>
</div>
<div class="paragraph">
<p>More specifically, the circuit breaker state is uniquely identified by the combination of the bean class (<code>java.lang.Class</code>) and the method object (<code>java.lang.reflect.Method</code>) representing the guarded method.</p>
</div>
<div class="paragraph">
<p>For example, if thereâ€™s a guarded method <code>doWork</code> on a bean which is <code>@RequestScoped</code>, each request will have its own instance of the bean, but all invocations of <code>doWork</code> will share the same circuit breaker state.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="interactions"><a class="anchor" href="#interactions"></a>Interactions with Other Strategies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>See <a href="../howto/multiple.html" class="page">How to Use Multiple Strategies</a> for an overview of how fault tolerance strategies are nested.</p>
</div>
<div class="paragraph">
<p>If <code>@Fallback</code> is used with <code>@CircuitBreaker</code>, the fallback method or handler may be invoked if a <code>CircuitBreakerOpenException</code> is thrown, depending on the fallback configuration.</p>
</div>
<div class="paragraph">
<p>If <code>@Retry</code> is used with <code>@CircuitBreaker</code>, each retry attempt is processed by the circuit breaker as an independent invocation.
If <code>CircuitBreakerOpenException</code> is thrown, the execution may be retried, depending on how retry is configured.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="#configuration"></a>Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are 7 configuration options, corresponding to the 7 members of the <code>@CircuitBreaker</code> annotation.</p>
</div>
<div class="sect2">
<h3 id="_requestvolumethreshold"><a class="anchor" href="#_requestvolumethreshold"></a><code>requestVolumeThreshold</code></h3>
<div class="paragraph">
<p>Type: <code>int</code></p>
</div>
<div class="paragraph">
<p>Default: <code>20</code></p>
</div>
<div class="paragraph">
<p>The size of the rolling window.
That is, the number of recent consecutive invocations tracked by a <em>closed</em> circuit breaker.</p>
</div>
</div>
<div class="sect2">
<h3 id="_failureratio"><a class="anchor" href="#_failureratio"></a><code>failureRatio</code></h3>
<div class="paragraph">
<p>Type: <code>double</code></p>
</div>
<div class="paragraph">
<p>Default: <code>0.5</code></p>
</div>
<div class="paragraph">
<p>The ratio of failures in the rolling window that causes a <em>closed</em> circuit breaker to move to <em>open</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_delay_delayunit"><a class="anchor" href="#_delay_delayunit"></a><code>delay</code> + <code>delayUnit</code></h3>
<div class="paragraph">
<p>Type: <code>long</code> + <code>ChronoUnit</code></p>
</div>
<div class="paragraph">
<p>Default: <code>5000 millis</code>, or 5 seconds</p>
</div>
<div class="paragraph">
<p>The delay after which an <em>open</em> circuit breaker moves to <em>half-open</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_successthreshold"><a class="anchor" href="#_successthreshold"></a><code>successThreshold</code></h3>
<div class="paragraph">
<p>Type: <code>int</code></p>
</div>
<div class="paragraph">
<p>Default: <code>1</code></p>
</div>
<div class="paragraph">
<p>The number of probe invocations allowed when the circuit breaker is <em>half-open</em>.
If they all succeed, the circuit breaker moves to <em>closed</em>, otherwise it moves back to <em>open</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="fail-on"><a class="anchor" href="#fail-on"></a><code>failOn</code></h3>
<div class="paragraph">
<p>Type: <code>Class&lt;? extends Throwable&gt;[]</code></p>
</div>
<div class="paragraph">
<p>Default: <code>{Throwable.class}</code></p>
</div>
<div class="paragraph">
<p>Set of exception types that the circuit breaker considers failures.</p>
</div>
</div>
<div class="sect2">
<h3 id="skip-on"><a class="anchor" href="#skip-on"></a><code>skipOn</code></h3>
<div class="paragraph">
<p>Type: <code>Class&lt;? extends Throwable&gt;[]</code></p>
</div>
<div class="paragraph">
<p>Default: <code>{}</code></p>
</div>
<div class="paragraph">
<p>Set of exception types that the circuit breaker considers success.
This configuration takes precedence over <code>failOn</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="metrics"><a class="anchor" href="#metrics"></a>Metrics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Circuit breaker exposes the following metrics:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ft.circuitbreaker.calls.total</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Counter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of times the circuit breaker logic was run. This is usually once per method call, but may be more than once if the method call is retried.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tags</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>method</code> - the fully qualified method name</p>
</li>
<li>
<p><code>circuitBreakerResult</code> = <code>[success|failure|circuitBreakerOpen]</code> - the result of the method call, as considered by the circuit breaker</p>
<div class="ulist">
<ul>
<li>
<p><code>success</code> - the method ran and was successful</p>
</li>
<li>
<p><code>failure</code> - the method ran and failed</p>
</li>
<li>
<p><code>circuitBreakerOpen</code> - the method did not run because the circuit breaker was in open or half-open state</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ft.circuitbreaker.state.total</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Gauge&lt;Long&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nanoseconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amount of time the circuit breaker has spent in each state</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tags</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>method</code> - the fully qualified method name</p>
</li>
<li>
<p><code>state</code> = <code>[open|closed|halfOpen]</code> - the circuit breaker state</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Although this metric is a <code>Gauge</code>, its value increases monotonically.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ft.circuitbreaker.opened.total</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Counter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of times the circuit breaker has moved from closed state to open state</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tags</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>method</code> - the fully qualified method name</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ft.circuitbreaker.state.current</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This is an additional feature of SmallRye Fault Tolerance and is not specified by MicroProfile Fault Tolerance.
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Gauge&lt;Long&gt;</code> (<code>0</code> or <code>1</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the circuit breaker is currently in given state (<code>1</code>) or not (<code>0</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tags</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>method</code> - the fully qualified method name</p>
</li>
<li>
<p><code>state</code> = <code>[open|closed|halfOpen]</code> - the circuit breaker state</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See <a href="metrics.html" class="page">the Metrics reference guide</a> for general metrics information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_extra_features"><a class="anchor" href="#_extra_features"></a>Extra Features</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_circuit_breaker_maintenance"><a class="anchor" href="#_circuit_breaker_maintenance"></a>Circuit Breaker Maintenance</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This is an additional feature of SmallRye Fault Tolerance and is not specified by MicroProfile Fault Tolerance.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is sometimes useful to see the circuit breaker status from within the application, or reset it to the initial state.
This is possible in two steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Give the circuit breaker a name by annotating the guarded method with <code>@CircuitBreakerName</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class MyService {
    @CircuitBreaker
    @CircuitBreakerName("hello-cb") <i class="conum" data-value="1"></i><b>(1)</b>
    public String hello() {
        ...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The circuit breaker guarding the <code>MyService.hello</code> method is given a name <code>hello-cb</code>.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Inject <code>CircuitBreakerMaintenance</code> and call its methods:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class Example {
    @Inject
    CircuitBreakerMaintenance maintenance;

    public void test() {
        System.out.println("Circuit breaker state: "
            + maintenance.currentState("hello-cb")); <i class="conum" data-value="1"></i><b>(1)</b>
        maintenance.resetAll(); <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtains current circuit breaker state.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Resets all circuit breakers to the initial state.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>CircuitBreakerMaintenance</code> interface provides 4 methods:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>currentState(name)</code>: returns current state of given circuit breaker.
The return type <code>CircuitBreakerState</code> is an <code>enum</code> with 3 values: <code>CLOSED</code>, <code>OPEN</code>, <code>HALF_OPEN</code>.</p>
</li>
<li>
<p><code>onStateChange(name, callback)</code>: registers a callback that will be called when given circuit breaker changes state.</p>
</li>
<li>
<p><code>reset(name)</code>: resets given circuit breaker to the initial state.</p>
</li>
<li>
<p><code>resetAll()</code>: resets all circuit breakers in the application to the initial state.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>See the javadoc of those methods for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="inspecting-exception-cause-chains"><a class="anchor" href="#inspecting-exception-cause-chains"></a>Inspecting Exception Cause Chains</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This is an additional feature of SmallRye Fault Tolerance and is not specified by MicroProfile Fault Tolerance.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This feature only works in the <a href="non-compat.html" class="page">non-compatible mode</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>@CircuitBreaker</code> annotation can specify that certain exceptions should be treated as failures (<code>failOn</code>) and others as successes (<code>skipOn</code>).
The specification limits this to inspecting the actual exception that was thrown.
However, in many cases, exceptions are wrapped and the exception the user wants to decide on is only present in the cause chain.</p>
</div>
<div class="paragraph">
<p>For that reason, in the non-compatible mode, if the actual thrown exception isn&#8217;t known failure or known success, SmallRye Fault Tolerance inspects the cause chain.
To be specific, in case a <code>@CircuitBreaker</code> method throws an exception, the decision process is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the <code>skipOn</code> exceptions are not default and the exception is assignable to one of the <code>skipOn</code> exceptions, the circuit breaker treats it as a success.</p>
</li>
<li>
<p>Otherwise, if the <code>failOn</code> exceptions are not default and the exception is assignable to one of the <code>failOn</code> exceptions, the circuit breaker treats it as a failure.</p>
</li>
<li>
<p>Otherwise, if the exception is assignable to one of the <code>skipOn</code> exceptions or its cause chain contains an exception assignable to one of the <code>skipOn</code> exceptions, the circuit breaker treats it as a success.</p>
</li>
<li>
<p>Otherwise, if the exception is assignable to one of the <code>failOn</code> exceptions or its cause chain contains an exception assignable to one of the <code>failOn</code> exceptions, the circuit breaker treats it as a failure.</p>
</li>
<li>
<p>Otherwise, the exception is treated as a success.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CircuitBreaker(requestVolumeThreshold = 10,
    skipOn = ExpectedOutcomeException.class, <i class="conum" data-value="1"></i><b>(1)</b>
    failOn = IOException.class) <i class="conum" data-value="2"></i><b>(2)</b>
public Result doSomething() {
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If <code>doSomething</code> throws an <code>ExpectedOutcomeException</code>, or a <code>WrapperException</code> whose cause is <code>ExpectedOutcomeException</code>, the circuit breaker treats it as a success.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If <code>doSomething</code> throws an <code>IOException</code>, or a <code>WrapperException</code> whose cause is <code>IOException</code>, the circuit breaker treats it as a failure.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CircuitBreaker(requestVolumeThreshold = 10,
    skipOn = ExpectedOutcomeException.class) <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
public Result doSomething() {
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If <code>doSomething</code> throws an <code>ExpectedOutcomeException</code>, or a <code>WrapperException</code> whose cause is <code>ExpectedOutcomeException</code>, the circuit breaker treats it as a success.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>There&#8217;s no <code>failOn</code>, so the 2nd step in the algorithm above is skipped.
This is what turns the <code>WrapperException</code> whose cause is <code>ExpectedOutcomeException</code> into a success.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="bulkhead.html">Bulkhead</a></span>
  <span class="next"><a href="timeout.html">Timeout</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>
    Sponsored by <a href="https://www.redhat.com"><img style="vertical-align: middle; height: 2.5em;" src="../../../_/img/redhat.svg" alt="Red Hat"></a>
  </p>
  <p>
    Made with <a href="https://github.com/smallrye/smallrye-antora-ui">SmallRye Antora UI</a>, which is licensed under the MPL-2.0 license.
    Includes portions of <a href="https://squidfunk.github.io/mkdocs-material/">Material for MkDocs</a>, which is licensed under the MIT license.
  </p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
