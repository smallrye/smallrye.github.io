<!DOCTYPE html>
<html>

<head>
  <title>Health Groups - experimental MicroProfile Health extension in SmallRye</title>
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlightjs-pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV="Content-Security-Policy" CONTENT="default-src 'none'; script-src 'self' www.redhat.com assets.adobedtm.com jsonip.com ajax.googleapis.com www.googletagmanager.com www.google-analytics.com use.fontawesome.com; style-src 'self'  fonts.googleapis.com use.fontawesome.com; img-src 'self' *; media-src 'self' ; frame-src www.googletagmanager.com; frame-ancestors 'none'; base-uri 'none'; object-src 'none'; form-action 'none'; font-src 'self' use.fontawesome.com fonts.gstatic.com;">
  <META HTTP-EQUIV="X-Frame-Options" CONTENT="DENY">
  <META HTTP-EQUIV="X-XSS-Protection" CONTENT="1; mode=block">
  <META HTTP-EQUIV="X-Content-Type-Options" CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="SmallRye is a project to share and collaborate on implementing specifications that are part of Eclipse MicroProfile.">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
</head>

<body class="post">

  <div class="content">
    <div class="navigation-wrapper">
  <div class="width-12-12">
    <div class="header navigation">
      <div class="logo-wrapper">
        <a href="/"><img class="project-logo" title="SmallRye" src="/assets/images/smallrye_project_logo.svg"></a>
      </div>
      <div class="nav-container">
        <nav>
          <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
          <ul class="nav-list">
            <li>
              <a href="/projects/" class="">Projects</a>
            </li>
            <li>
              <a href="/community/" class="">Community</a>
            </li>
            <li>
              <a href="/blog/" class="active">Blog</a>
            </li>
            <li>
              <a href="/docs/index.html" class="">Documentation</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>

    <div class="post-page grid-wrapper">
  <div class="grid__item width-10-12 doc-content">
    <h1>Health Groups - experimental MicroProfile Health extension in SmallRye</h1>
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>If you are reading this blog, you have probably already heard about
<a href="https://github.com/eclipse/microprofile-health">Eclipse MicroProfile Health</a>
technology. In this article, we will introduce a new experimental extension to
MicroProfile Health 2.2 called Health groups.</p>
</div>
<div class="paragraph">
<p>All of the source code that we will present in this article is available at this
GitHub repository <a href="https://github.com/xstefank/health-groups" class="bare">https://github.com/xstefank/health-groups</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="microprofile_2_2_health_checks">MicroProfile 2.2 health checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As you know, to define a health check procedure in MicroProfile Health you need
something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package io.xstefank;

import org.eclipse.microprofile.health.HealthCheck;
import org.eclipse.microprofile.health.HealthCheckResponse;
import org.eclipse.microprofile.health.Readiness;

import javax.enterprise.context.ApplicationScoped;

@ApplicationScoped // 1. CDI scope
@Readiness         // 2. Qualifier (Readiness, Liveness, Health)
public class ReadinessHealthCheck implements HealthCheck {   // 3. implements HealthCheck interface

    @Override
    public HealthCheckResponse call() {
        return HealthCheckResponse.up(ReadinessHealthCheck.class.getSimpleName());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>So just to recap, to define a health check your class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>needs to be a CDI bean</p>
</li>
<li>
<p>needs to have one of the health qualifiers (Readiness, Liveness, or deprecated Health)</p>
</li>
<li>
<p>must implement the HealthCheck interface</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is everything that you can use in MicroProfile 2.2. But what if you have a
use case that doesn&#8217;t fall into one of Readiness or Liveness categories? The answer
is custom health groups.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="health_groups">Health Groups</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SmallRye Health 2.2.0 (already included in Quarkus 1.4.0) comes with a new addition to this API
called health groups. A health group is basically a custom group of health check
procedures that the user defines based on individual needs. As you probably noticed,
Readiness and Liveness health checks already represent two predefined health groups.
With the health groups feature you can define as many additional health check groups
as you need.</p>
</div>
<div class="sect2">
<h3 id="defining_a_health_group">Defining a health Group</h3>
<div class="paragraph">
<p>To define a health group you need only to declare at least one health check
procedure that belongs to the health group:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package io.xstefank;

import io.smallrye.health.HealthGroup;
import org.eclipse.microprofile.health.HealthCheck;
import org.eclipse.microprofile.health.HealthCheckResponse;

import javax.enterprise.context.ApplicationScoped;

@ApplicationScoped
@HealthGroup("custom-group-1")
public class CustomGroup1Check implements HealthCheck {

    @Override
    public HealthCheckResponse call() {
        return HealthCheckResponse.up(CustomGroup1HC.class.getSimpleName());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>So the only difference now is the change of the qualifier for which we now use
<code>io.smallrye.health.HealthGroup</code>. This qualifier takes a string argument
representing the name of the health group. This is all that needs to be done
to define a new custom health group and a health check procedure that belongs to it.</p>
</div>
</div>
<div class="sect2">
<h3 id="accessing_custom_health_groups">Accessing custom health groups</h3>
<div class="paragraph">
<p>Accessing the custom health groups is done a similar manner to the original
MicroProfile Health 2.2 health invocations. The URL to access a custom group is
<code>HOST:PORT/health/group/{group-name}</code>. This will return all health check procedures
belonging to the groups <code>{group-name}</code>. You can also find all health check
procedures that belong to any of the custom defined health group by accessing
<code>HOST:PORT/health/group</code>. Here is a summary of endpoints exposed in Quarkus
1.4.0:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Path</th>
<th class="tableblock halign-left valign-top">Health checks</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/health</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Readiness, @Liveness, @Health</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/health/ready</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Readiness</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/health/live</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Liveness</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/health/group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all @HealthGroup(*)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/health/groups/group-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@HealthGroup("group-name")</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="combining_different_health_groups">Combining different health groups</h3>
<div class="paragraph">
<p>You are allowed to use more than one qualifier on any health check procedure that
you define. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package io.xstefank;

import io.smallrye.health.HealthGroup;
import org.eclipse.microprofile.health.HealthCheck;
import org.eclipse.microprofile.health.HealthCheckResponse;
import org.eclipse.microprofile.health.Readiness;

import javax.enterprise.context.ApplicationScoped;

@ApplicationScoped
@HealthGroup("custom-group-1")
@HealthGroup("custom-group-2")
@Readiness
public class CustomGroup2ReadinessCheck implements HealthCheck {

    @Override
    public HealthCheckResponse call() {
        return HealthCheckResponse.up(CustomGroup2ReadinessCheck.class.getSimpleName());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This procedure will now be available in <code>custom-group-1</code>, <code>custom-group-2</code> and the
<code>readiness</code> groups.</p>
</div>
<div class="paragraph">
<p><code>/health/group</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
    "checks": [
        {
            "name": "CustomGroup1Check",
            "status": "UP"
        },
        {
            "name": "CustomGroup2ReadinessCheck",
            "status": "UP"
        }
    ],
    "status": "UP"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>/health/group/custom-group-1</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
    "checks": [
        {
            "name": "CustomGroup1Check",
            "status": "UP"
        },
        {
            "name": "CustomGroup2ReadinessCheck",
            "status": "UP"
        }
    ],
    "status": "UP"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>/health/group/custom-group-2</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
    "checks": [
        {
            "name": "CustomGroup2ReadinessCheck",
            "status": "UP"
        }
    ],
    "status": "UP"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>/health/ready</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
    "checks": [
        {
            "name": "CustomGroup2ReadinessCheck",
            "status": "UP"
        },
        {
            "name": "ReadinessHealthCheck",
            "status": "UP"
        }
    ],
    "status": "UP"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where this can come particularly handy is if you want to reuse predefined
readiness and liveness procedures for custom views or simplified processing. For
example, if you have several liveness procedures one of which is not essential
and takes a long time you may want to define a health group that will be excluding
the expensive liveness health check computation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary">Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We introduced the new experimental feature extending the MicroProfile Health 2.2
API called the Health Groups. This feature is available for use in the SmallRye
Health 2.2.0 (Quarkus 1.4.0) and later releases. In Quarkus, the health Groups are
already included in the <code>smallrye-health</code> extension. If you wish to use in a
different container you need to add following dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependency&gt;
  &lt;groupId&gt;io.smallrye&lt;/groupId&gt;
  &lt;artifactId&gt;smallrye-health&lt;/artifactId&gt;
  &lt;version&gt;${version.io.smallrye.health}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;io.smallrye&lt;/groupId&gt;
  &lt;artifactId&gt;smallrye-health-extension-api&lt;/artifactId&gt;
  &lt;version&gt;${version.io.smallrye.health}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we want to test features that
we will eventually try to specify in MicroProfile, you can expect that if this
feature will be used in Quarkus you will eventually see it in the MicroProfile
Health specification. So if you are interested, please feel free to try it out,
test it, and report any issues or enhancements in
<a href="https://github.com/smallrye/smallrye-health/issues">our issue tracker</a>.</p>
</div>
</div>
</div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/smallrye_project_logo.svg" class="project-logo" title="SmallRye"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">SmallRye is open source under <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>. <br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/smallrye/smallrye.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="/">Home</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Contribute</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://twitter.com/smallrye_io">Follow us</a></li>
          
            <li><a href="https://github.com/smallrye">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://gitter.im/smallrye-io/community">Chatroom</a></li>
          
            <li><a href="https://groups.google.com/d/forum/smallrye">Google&nbsp;Groups</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-6-12 more-links">
        <span>External Links</span>
        <ul class="footer-links">
          
            <li><a href="https://microprofile.io/" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://github.com/eclipse?utf8=✓&q=microprofile" target="_blank">Eclipse MicroProfile on GitHub</a></li>
          
        </ul>
      </div>
    
  </div>
</div>
  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a>
      | <a href="https://www.redhat.com/en/about/privacy-policy">Red Hat Privacy Policy</a>
    </span>
    <span class="redhat">
      a Red Hat sponsored project   
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script type="text/javascript" src="/assets/javascript/satellite.js"></script>
</body>

</html>
