<!DOCTYPE html>
<html>

<head>
  <title>SmallRye Config 1.8 Released</title>
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlightjs-pack.js" type="text/javascript"></script>
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      https://www.redhat.com
      https://static.redhat.com
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://www.google-analytics.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <META HTTP-EQUIV="X-Frame-Options" CONTENT="DENY">
  <META HTTP-EQUIV="X-XSS-Protection" CONTENT="1; mode=block">
  <META HTTP-EQUIV="X-Content-Type-Options" CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="SmallRye is a project to share and collaborate on implementing specifications that are part of Eclipse MicroProfile.">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
</head>

<body class="post">

  <div class="content">
    <div class="navigation-wrapper">
  <div class="width-12-12">
    <div class="header navigation">
      <div class="logo-wrapper">
        <a href="/"><img class="project-logo" title="SmallRye" src="/assets/images/smallrye_project_logo.svg"></a>
      </div>
      <div class="nav-container">
        <nav>
          <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
          <ul class="nav-list">
            <li>
              <a href="/projects/" class="">Projects</a>
            </li>
            <li>
              <a href="/community/" class="">Community</a>
            </li>
            <li>
              <a href="/blog/" class="active">Blog</a>
            </li>
            <li>
              <a href="/docs/index.html" class="">Documentation</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>

    <div class="post-page grid-wrapper">
  <div class="grid__item width-10-12 doc-content">
    <h1>SmallRye Config 1.8 Released</h1>
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>SmallRye Config version 1.8 was released a few days ago.</p>
</div>
<div class="paragraph">
<p>The latest version of SmallRye Config introduced a few experimental changes to enhance the API and to make SmallRye
Config more extensible. One of the experimental changes is the new interceptor model, to intercept the lookup of a
configuration value.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the_configsourceinterceptor">The ConfigSourceInterceptor</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>ConfigSourceInterceptor</code> allows to intercept the resolution of a configuration name before the <code>Config</code> resolves
the configuration value and before any conversion taking place. This is useful to implement features like
property expansion or configuration profiles.</p>
</div>
<div class="paragraph">
<p>Implementations of <code>ConfigSourceInterceptor</code> are loaded via the <code>java.util.ServiceLoader</code> mechanism and can be
registered by providing a resource named <code>META-INF/services/io.smallrye.config.ConfigSourceInterceptor</code>, which
contains the fully qualified <code>ConfigSourceInterceptor</code> implementation class name as its content.</p>
</div>
<div class="paragraph">
<p>A single method must be implemented, <code>ConfigValue getValue(ConfigSourceInterceptorContext context, String name)</code>. The
<code>ConfigSourceInterceptorContext</code> is used to proceed with the interceptor chain. The chain can be short-circuited by
returning an instance of <code>ConfigValue</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public interface ConfigSourceInterceptor extends Serializable {
    ConfigValue getValue(ConfigSourceInterceptorContext context, String name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ConfigValue</code> objects hold information about the key name, value, config source origin, and ordinal.</p>
</div>
<div class="paragraph">
<p>Additionally, the <code>ConfigSourceInterceptor</code> may also intercept resolution of configuration names or configuration
values with the methods <code>Iterator&lt;String&gt; iterateNames(ConfigSourceInterceptorContext context)</code> and
<code>Iterator&lt;ConfigValue&gt; iterateValues(ConfigSourceInterceptorContext context)</code>.</p>
</div>
<div class="paragraph">
<p>The Interceptor chain applies before any conversion takes place.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementation">Implementation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the Interceptor API, it becomes trivial to implement a logging mechanism and to find out which <code>ConfigSource</code>
loaded the resolved config:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class LoggingConfigSourceInterceptor implements ConfigSourceInterceptor {
    private static final Logger LOG = Logger.getLogger("io.smallrye.config");

    @Override
    public ConfigValue getValue(final ConfigSourceInterceptorContext context, final String name) {
        final ConfigValue configValue = context.proceed(name);
        final String key = configValue.getName();
        final String value = configValue.getValue();
        final String configSource = configValue.getConfigSourceName();

        LOG.infov("The key {0} was loaded from {1} with the value {2}", key, configSource, value);

        return configValue;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>SmallRye Config does ship with its own logging interceptor, so you don&#8217;t need to implement one.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="built_in_interceptors">Built-In Interceptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SmallRye Config provides the following built-in interceptors to expand its feature set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>RelocateConfigSourceInterceptor</code></p>
</li>
<li>
<p><code>ProfileConfigSourceInterceptor</code></p>
</li>
<li>
<p><code>ExpressionConfigSourceInterceptor</code></p>
</li>
<li>
<p><code>FallbackConfigSourceInterceptor</code></p>
</li>
<li>
<p><code>LoggingConfigSourceInterceptor</code></p>
</li>
<li>
<p><code>SecretKeyConfigSourceInterceptor</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Not every interceptor is registered by default. Only the <code>ProfileConfigSourceInterceptor</code>,
<code>ExpressionConfigSourceInterceptor</code> and <code>SecretKeyConfigSourceInterceptor</code> are added on new instances of <code>Config</code>.
Other interceptors require manual registration via the <code>ServiceLoader</code> mechanism.</p>
</div>
<div class="paragraph">
<p>To learn more about all the built-in interceptors, please refer to the
<a href="https://smallrye.io/docs/smallrye-config/interceptors/interceptors.html#_built_in_interceptors">documentation page</a>.</p>
</div>
<div class="sect2">
<h3 id="expression_expansion">Expression Expansion</h3>
<div class="paragraph">
<p>The <code>ExpressionConfigSourceInterceptor</code> provides expression expansion on configuration values. An expression string is
a mix of plain strings and expression segments, which are wrapped into <code>${ &#8230;&#8203; }</code>.</p>
</div>
<div class="paragraph">
<p>For instance, consider the following configuration properties file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">my.prop=1234
expression=${my.prop}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the <code>expression</code> configuration will be resolved and expanded to the value <code>1234</code>.</p>
</div>
<div class="paragraph">
<p>Additionally, the expression expansion engine supports the following segments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${expression:value}</code> - Provides a default value after the <code>:</code> if the expansion doesn&#8217;t find a value.</p>
</li>
<li>
<p><code>${my.prop${compose}}</code> - Composed expressions. Inner expressions are resolved first.</p>
</li>
<li>
<p><code>${my.prop}${my.prop}</code> - Multiple expressions.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuration_profiles">Configuration Profiles</h3>
<div class="paragraph">
<p>The <code>ProfileConfigSourceInterceptor</code> allows multiple configurations with the same name and selects them via
a profile property.</p>
</div>
<div class="paragraph">
<p>To be able to set properties with the same name, each property needs to be prefixed with <code>%</code> followed by the profile
name and a dot:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">my.prop=1234
%dev.my.prop=5678</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lookup is always performed with the <code>my.prop</code> property name. To use the profile <code>dev</code>, the configuration
<code>smallrye.config.profile=dev</code> has to be set in any valid <code>ConfigSource</code>.</p>
</div>
<div class="paragraph">
<p>When looking up the property <code>my.prop</code> with the <code>dev</code> profile active, the value is <code>5678</code>.</p>
</div>
<div class="paragraph">
<p>Only one profile can be active at any given time.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="api_enhancements">API Enhancements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Aside from interceptors, a few additional API enhancements shipped with the latest version of SmallRye Config:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ConfigValue</code> - The ConfigValue is a metadata object that holds additional information after the lookup of a
configuration.</p>
</li>
<li>
<p><code>ConfigValueConfigSource</code> - Extends the original <code>ConfigSource</code> to expose methods that return a <code>ConfigValue</code>.</p>
</li>
<li>
<p><code>SmallRyeConfigBuilder#withSecretKeys</code> - Hide configuration properties that contain passwords or other kinds of
secrets to prevent accidental exposure of such values.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary">Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All the new features detailed here are experimental. The team is happy with them, and they had careful consideration
when designed. We cannot guarantee that they won&#8217;t suffer any changes in the next few releases, especially considering
that the SmallRye team is also pushing to have these added to the MicroProfile Config specification, which may require
some changes.</p>
</div>
<div class="paragraph">
<p>This shouldn&#8217;t discourage developers to use these new features. We believe these add a lot of utility and improve the
developer experience regarding configuration of applications.</p>
</div>
<div class="paragraph">
<p>Please, feel free to drop us any feedback in the <a href="mailto:smallrye@googlegroups.com">SmallRye Mailing List</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="additional_resources">Additional Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/smallrye/smallrye-config/releases/tag/1.8.0">Release Notes</a></p>
</li>
<li>
<p><a href="https://smallrye.io/docs/smallrye-config/index.html">Documentation</a></p>
</li>
</ul>
</div>
</div>
</div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/smallrye_project_logo.svg" class="project-logo" title="SmallRye"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">SmallRye is open source under <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>. <br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/smallrye/smallrye.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="/">Home</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Contribute</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://twitter.com/smallrye_io">Follow us</a></li>
          
            <li><a href="https://github.com/smallrye">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://quarkusio.zulipchat.com">Chatroom</a></li>
          
            <li><a href="https://groups.google.com/d/forum/smallrye">Google&nbsp;Groups</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-6-12 more-links">
        <span>External Links</span>
        <ul class="footer-links">
          
            <li><a href="https://microprofile.io/" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://github.com/eclipse?utf8=✓&q=microprofile" target="_blank">Eclipse MicroProfile on GitHub</a></li>
          
        </ul>
      </div>
    
  </div>
</div>
  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a>
      | <a href="https://www.redhat.com/en/about/privacy-policy">Red Hat Privacy Policy</a>
    </span>
    <span class="redhat">
      a Red Hat sponsored project   
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script type="text/javascript" src="/assets/javascript/satellite.js"></script>
</body>

</html>
