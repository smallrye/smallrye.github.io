<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Generate JWT Tokens :: SmallRye documentation</title>
    <link rel="prev" href="configuration.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../_/css/site.css">
    <script>var uiRootPath = '../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <button class="nav-toggle"></button>

      <a class="navbar-item title" href="index.html">SmallRye JWT</a>

      <div class="navbar-item has-dropdown is-hoverable">
        <span class="navbar-link">master</span>
        <div class="navbar-dropdown navbar-menu">
            <a class="navbar-item  is-current" href="index.html">master</a>
        </div>
      </div>


      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>

    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <span class="navbar-link">Projects</span>
          <div class="navbar-dropdown">
              <a class="navbar-item" href="../index/index/index.html">Index</a>
              <a class="navbar-item" href="../smallrye-fault-tolerance/6.6.2/index.html">SmallRye Fault Tolerance</a>
              <a class="navbar-item" href="../smallrye-health/3.0.1/index.html">SmallRye Health</a>
              <a class="navbar-item" href="index.html">SmallRye JWT</a>
              <a class="navbar-item" href="../smallrye-metrics/3.0.0/index.html">SmallRye Metrics</a>
          </div>
        </div>

        <a class="navbar-item" href="https://smallrye.io/">SmallRye.io main website</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="smallrye-jwt" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list nav-list-level-0">
  <li class="nav-item nav-item-level-0">
<ul class="nav-list nav-list-level-1">
  <li class="nav-item nav-item-level-1">
    <a class="nav-link" href="index.html">Index</a>
  </li>
  <li class="nav-item nav-item-level-1">
    <a class="nav-link" href="configuration.html">Configuration</a>
  </li>
  <li class="nav-item nav-item-level-1 is-current-page">
    <a class="nav-link" href="generate-jwt.html">Generate JWT Tokens</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
  <div class="content">
<aside class="toc sidebar" data-title="Table of contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
  <a href="https://github.com/smallrye/smallrye-jwt/edit/main/doc/modules/ROOT/pages/generate-jwt.adoc" class="edit-this-page" title="Edit this page">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>
<h1 class="page">Generate JWT Tokens</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>JWT claims can be signed or encrypted or signed first and the nested JWT token encrypted. Signing the claims is used
most often to secure the claims. What is known today as a JWT token is typically produced by signing the claims in a
JSON format using the steps described in the <a href="https://tools.ietf.org/html/rfc7515">JSON Web Signature</a> specification.
However, when the claims are sensitive, their confidentiality can be guaranteed by following the steps described in the
<a href="https://tools.ietf.org/html/rfc7516">JSON Web Encryption</a> specification to produce a JWT token with the encrypted claims.
Finally both the confidentiality and integrity of the claims can be further enforced by signing them first and then
encrypting the nested JWT token.</p>
</div>
<div class="paragraph">
<p>SmallRye JWT project provides a JWT Build API for securing the JWT claims using all of these options.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_maven_dependency"><a class="anchor" href="#_maven_dependency"></a>Maven dependency</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.smallrye&lt;/groupId&gt;
  &lt;artifactId&gt;smallrye-jwt-build&lt;/artifactId&gt;
  &lt;version&gt;${smallrye.jwt.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_jwtclaimsbuilder_and_set_the_claims"><a class="anchor" href="#_create_jwtclaimsbuilder_and_set_the_claims"></a>Create JwtClaimsBuilder and set the claims</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first step is to initialize a <code>JwtClaimsBuilder</code> using one of the options below and add some claims to it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.Collections;
import io.smallrye.jwt.build.Jwt;
import io.smallrye.jwt.build.JwtClaimsBuilder;
...
// Create an empty builder and add some claims
JwtClaimsBuilder builder1 = Jwt.claims();
builder1.claim("customClaim", "custom-value").issuer("https://issuer.org");
// Or start typing the claims immediately:
// JwtClaimsBuilder builder1 = Jwt.upn("Alice");

// Builder created from the existing claims
JwtClaimsBuilder builder2 = Jwt.claims("/tokenClaims.json");

// Builder created from a map of claims
JwtClaimsBuilder builder3 = Jwt.claims(Collections.singletonMap("customClaim", "custom-value"));

// Builder created from JsonObject
JsonObject userName = Json.createObjectBuilder().add("username", "Alice").build();
JsonObject userAddress = Json.createObjectBuilder().add("city", "someCity").add("street", "someStreet").build();
JsonObject json = Json.createObjectBuilder(userName).add("address", userAddress).build();
JwtClaimsBuilder builder4 = Jwt.claims(json);

// Builder created from JsonWebToken
@Inject JsonWebToken token;
JwtClaimsBuilder builder5 = Jwt.claims(token);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API is fluent so the builder initialization can be done as part of the fluent API sequence. The builder will also
set <code>iat</code> (issued at) claim to the current time, <code>exp</code> (expires at) claim to a sum of the <code>iat</code> claim and <code>smallrye.jwt.new-token.lifespan</code>
property values and <code>jti</code> (unique token identifier) claim if they have not already been set, so one can skip setting them when possible.</p>
</div>
<div class="paragraph">
<p>The next step is to decide how to secure the claims.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sign_the_claims"><a class="anchor" href="#_sign_the_claims"></a>Sign the claims</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The claims can be signed immediately or after the <code>JSON Web Signature</code> headers have been set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.smallrye.jwt.build.Jwt;
...

// Sign the claims using the private key loaded from the location set with a 'smallrye.jwt.sign.key.location' property.
// No 'jws()' transition is necessary.
String jwt1 = Jwt.claims("/tokenClaims.json").sign();

// Set the headers and sign the claims with an RSA private key loaded in the code (the implementation of this method is omitted). Note a 'jws()' transition to a 'JwtSignatureBuilder'.
String jwt2 = Jwt.claims("/tokenClaims.json").jws().keyId("kid1").header("custom-header", "custom-value").sign(getPrivateKey());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>alg</code> (algorithm) header is set to <code>RS256</code> by default.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_encrypt_the_claims"><a class="anchor" href="#_encrypt_the_claims"></a>Encrypt the claims</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The claims can be encrypted immediately or after the <code>JSON Web Encryption</code> headers have been set the same way as they
can be signed. The only minor difference is that encrypting the claims always requires a <code>jwe() JwtEncryptionBuilder</code>
transition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.smallrye.jwt.build.Jwt;
...

// Encrypt the claims using the public key loaded from the location set with a 'smallrye.jwt.encrypt.key.location' property.
String jwt1 = Jwt.claims("/tokenClaims.json").jwe().encrypt();

// Set the headers and encrypt the claims with an RSA public key loaded in the code (the implementation of this method is omitted).
String jwt2 = Jwt.claims("/tokenClaims.json").jwe().header("custom-header", "custom-value").encrypt(getPublicKey());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>alg</code> (key management algorithm) header is set to <code>RSA-OAEP</code> and the <code>enc</code> (content encryption header) is set to <code>A256GCM</code> by default.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sign_the_claims_and_encrypt_the_nested_jwt_token"><a class="anchor" href="#_sign_the_claims_and_encrypt_the_nested_jwt_token"></a>Sign the claims and encrypt the nested JWT token</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The claims can be signed and then the nested JWT token encrypted by combining the sign and encrypt steps.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.smallrye.jwt.build.Jwt;
...

// Sign the claims and encrypt the nested token using the private and public keys loaded from the locations set with the 'smallrye.jwt.sign.key.location' and 'smallrye.jwt.encrypt.key.location' properties respectively.
String jwt = Jwt.claims("/tokenClaims.json").innerSign().encrypt();</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_fast_jwt_generation"><a class="anchor" href="#_fast_jwt_generation"></a>Fast JWT Generation</h3>
<div class="paragraph">
<p>If <code>smallrye.jwt.sign.key.location</code> or/and <code>smallrye.jwt.encrypt.key.location</code> properties are set then one can secure the existing claims (resources, maps, JsonObjects) with a single call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// More compact than Jwt.claims("/claims.json").sign();
Jwt.sign("/claims.json");

// More compact than Jwt.claims("/claims.json").jwe().encrypt();
Jwt.encrypt("/claims.json");

// More compact than Jwt.claims("/claims.json").innerSign().encrypt();
Jwt.signAndEncrypt("/claims.json");</code></pre>
</div>
</div>
<div class="paragraph">
<p>As mentioned above, <code>iat</code>, <code>exp</code>, <code>jti</code> and <code>iss</code> claims will be added if needed.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Smallrye JWT supports the following properties which can be used to customize the way claims are signed and encrypted:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.encrypt.key.location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of a key which will be used to encrypt the claims or inner JWT when a no-argument encrypt() method is called.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.encrypt.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key value which will be used to encrypt the claims or inner JWT when a no-argument encrypt() method is called.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.encrypt.key.id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encryption key identifier which is checked only when JWK keys are used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.encrypt.relax-key-validation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relax the validation of the encryption keys</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.sign.key.location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of a key which will be used to sign the claims when either a no-argument sign() or innerSign() method is called.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.sign.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key value which will be used to sign the claims when either a no-argument sign() or innerSign() method is called.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.sign.key.id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signing key identifier which is checked only when JWK keys are used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.sign.relax-key-validation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relax the validation of the signing keys</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.new-token.signature-algorithm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RS256</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signature algorithm. This property will be checked if the JWT signature builder has not already set the signature algorithm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.new-token.key-encryption-algorithm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RSA-OAEP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key encryption algorithm. This property will be checked if the JWT encryption builder has not already set the key encryption algorithm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.new-token.content-encryption-algorithm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>A256GCM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content encryption algorithm. This property will be checked if the JWT encryption builder has not already set the content encryption algorithm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.new-token.lifespan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>300</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token lifespan in seconds which will be used to calculate an <code>exp</code> (expiry) claim value if this claim has not already been set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.new-token.issuer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token issuer which can be used to set an <code>iss</code> (issuer) claim value if this claim has not already been set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.new-token.audience</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token audience which can be used to set an <code>aud</code> (audience) claim value if this claim has not already been set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.new-token.override-matching-claims</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Override the existing <code>iss</code> or <code>aud</code> claim values if <code>smallrye.jwt.new-token.issuer</code> or <code>smallrye.jwt.new-token.audience</code> properties are set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.keystore.type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>JKS</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property can be used to customize a keystore type if either <code>smallrye.jwt.sign.key.location</code> or <code>smallrye.jwt.encrypt.key.location</code> or both of these properties point to a <code>KeyStore</code> file. If it is not set then the file name will be checked to determine the keystore type before defaulting to <code>JKS</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.keystore.provider</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property can be used to customize a <code>KeyStore</code> provider if <code>smallrye.jwt.sign.key.location</code> or <code>smallrye.jwt.encrypt.key.location</code> point to a <code>KeyStore</code> file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.keystore.password</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keystore password. If <code>smallrye.jwt.sign.key.location</code> or <code>smallrye.jwt.encrypt.key.location</code> point to a <code>KeyStore</code> file then this property has be set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.keystore.encrypt.key.alias</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property has to be set to identify a public encryption key which will be extracted from <code>KeyStore</code> from a matching certificate if <code>smallrye.jwt.encrypt.key.location</code> points to a <code>KeyStore</code> file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.keystore.sign.key.alias</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property has to be set to identify a private signing key if <code>smallrye.jwt.sign.key.location</code> points to a <code>KeyStore</code> file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smallrye.jwt.keystore.sign.key.password</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property may be set if a private signing key&#8217;s password in <code>KeyStore</code> is different to <code>smallrye.jwt.keystore.password</code> when <code>smallrye.jwt.sign.key.location</code> points to a <code>KeyStore</code> file.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="configuration.html">Configuration</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>
    Sponsored by <a href="https://www.redhat.com"><img style="vertical-align: middle; height: 2.5em;" src="../_/img/redhat.svg" alt="Red Hat"></a>
  </p>
  <p>
    Made with <a href="https://github.com/smallrye/smallrye-antora-ui">SmallRye Antora UI</a>, which is licensed under the MPL-2.0 license.
    Includes portions of <a href="https://squidfunk.github.io/mkdocs-material/">Material for MkDocs</a>, which is licensed under the MIT license.
  </p>
</footer>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
