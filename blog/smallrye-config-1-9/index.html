<!DOCTYPE html>
<html>

<head>
  <title>SmallRye Config 1.9 Released</title>
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlightjs-pack.js" type="text/javascript"></script>
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      https://www.redhat.com
      https://static.redhat.com
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://www.google-analytics.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <META HTTP-EQUIV="X-Frame-Options" CONTENT="DENY">
  <META HTTP-EQUIV="X-XSS-Protection" CONTENT="1; mode=block">
  <META HTTP-EQUIV="X-Content-Type-Options" CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="SmallRye is a project to share and collaborate on implementing specifications that are part of Eclipse MicroProfile.">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
</head>

<body class="post">

  <div class="content">
    <div class="navigation-wrapper">
  <div class="width-12-12">
    <div class="header navigation">
      <div class="logo-wrapper">
        <a href="/"><img class="project-logo" title="SmallRye" src="/assets/images/smallrye_project_logo.svg"></a>
      </div>
      <div class="nav-container">
        <nav>
          <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
          <ul class="nav-list">
            <li>
              <a href="/projects/" class="">Projects</a>
            </li>
            <li>
              <a href="/community/" class="">Community</a>
            </li>
            <li>
              <a href="/blog/" class="active">Blog</a>
            </li>
            <li>
              <a href="/docs/index.html" class="">Documentation</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>

    <div class="post-page grid-wrapper">
  <div class="grid__item width-10-12 doc-content">
    <h1>SmallRye Config 1.9 Released</h1>
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In SmallRye Config 1.9 we continue our innovation and experimentation model, by bringing additional features and
enhancements to the API. This release introduces the following big changes:</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="config_mappings">Config Mappings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A Config Mapping provides a way to group multiple configuration properties into a single cohesive API. A Config Mapping
requires a simple interface with minimal metadata configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@ConfigMapping(prefix = "server")
interface Server {
    String host();

    int port();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Server</code> interface retrieves and maps configuration properties with the name <code>server.host</code> into the
<code>Server.host()</code> and <code>server.port</code> into <code>Server.port()</code> method. The configuration property name to lookup
builds from the <code>@ConfigMapping</code> annotation prefix and the method name with <code>.</code> (dot) as the separator. The
<code>@ConfigMapping</code> annotation is used to auto-discover and register these mapping interfaces in a CDI aware environment.
In non-CDI environments, register the Config Mapping via <code>SmallRyeConfigBuilder#withMapping</code>.</p>
</div>
<div class="paragraph">
<p>To retrieve such Config Mapping, a simple <code>@Inject</code> in any CDI aware bean is enough:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Inject
Server server;

void businessMethod() {
    String host = server.host();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To retrieve the Config Mapping in non-CDI environments use the API
<code>io.smallrye.config.SmallRyeConfig#getConfigMapping</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">SmallRyeConfig config = (SmallRyeConfig) ConfigProvider.getConfig();
Server server = config.getConfigMapping(Server.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, Config Mappings also support:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Automatic conversion of the configuration type.</p>
</li>
<li>
<p>Nested Config Mapping groups.</p>
</li>
<li>
<p>Validate if configuration properties exist at the startup.</p>
</li>
<li>
<p><code>Map</code>, <code>Optional</code>, and primitive types.</p>
</li>
<li>
<p><code>@WithName</code> to override the property name.</p>
</li>
<li>
<p><code>@WithConverter</code> to override the converter to use.</p>
</li>
<li>
<p><code>@WithDefault</code> to set the default value if none is found in the config sources.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Combining all of these features, we can write a Config Mapping that looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@ConfigMapping(prefix = "server")
public interface Server {
    String host();

    int port();

    @WithConverter(DurationConverter.class)
    Duration timeout();

    @WithName("io-threads")
    int threads();

    Map&lt;String, String&gt; form();

    Optional&lt;Ssl&gt; ssl();

    Optional&lt;Proxy&gt; proxy();

    Log log();

    interface Ssl {
        int port();

        String certificate();

        @WithDefault("TLSv1.3,TLSv1.2")
        List&lt;String&gt; protocols();
    }

    interface Proxy {
        boolean enable();
    }

    interface Log {
        @WithDefault("false")
        boolean enabled();

        @WithDefault(".log")
        String suffix();

        @WithDefault("true")
        boolean rotate();

        @WithDefault("COMMON")
        Pattern pattern();

        enum Pattern {
            COMMON,
            SHORT,
            COMBINED,
            LONG;
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For additional information, check out our documentation about
<a href="https://smallrye.io/docs/smallrye-config/mapping/mapping.html">Config Mappings</a> and the example in the
<a href="https://github.com/smallrye/smallrye-config/tree/main/examples/mapping" class="bare">https://github.com/smallrye/smallrye-config/tree/main/examples/mapping</a> SmallRye Config Github repo.</p>
</div>
<div class="paragraph">
<p>In MicroProfile Config 2.0, an initial version for this feature will be available. It doesn&#8217;t support all the features
implemented in SmallRye Config, but the plan is to keep evolving and add more functionality based on the feedback of
the community. You can read more about it
<a href="https://github.com/eclipse/microprofile-config/blob/main/spec/src/main/asciidoc/configexamples.asciidoc">here</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configurable_config_sources">Configurable Config Sources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A highly requested feature is the ability to configure custom Config Sources, meaning it should be possible to
retrieve configuration values from other sources before building our own. Take for instance a Database based Config
Source. Such a source requires additional configurations like URL, username, and password to connect to the database.
Where do we set these configurations?</p>
</div>
<div class="paragraph">
<p>The new <code>ConfigSourceFactory</code> API provides a context with access to the currently available configuration. With a
<code>ConfigSourceFactory</code>, it is possible to bootstrap a <code>ConfigSource</code> that configures itself with other sources.</p>
</div>
<div class="paragraph">
<p>The <code>ConfigSourceFactory</code> requires the implementation of a single method
<code>ConfigSource getConfigSource(ConfigSourceContext context)</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Override
public class ConfigMapConfigSourceFactory implements ConfigSourceFactory {
    @Override
    public ConfigSource getConfigSource(final ConfigSourceContext context) {
        final ConfigValue value = context.getValue("config.map.dir.source");
        if (value == null || value.getValue() == null) {
            throw new IllegalArgumentException("CONFIG_MAP_DIR_SOURCE not defined");
        }

        return new FileSystemConfigSource(value.getValue());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The provided <code>ConfigSourceContext</code> may call a single method <code>ConfigValue getValue(String name)</code>. This method lookups
configuration names in all sources already initialized by the <code>Config</code> even if they have a lower priority than the one
defined in the <code>ConfigSourceFactory</code>. A`ConfigSource` produced by a <code>ConfigSourceFactory</code> is not taken into account to
configure other sources produced by lower priority <code>ConfigSourceFactory</code>. To register a <code>ConfigSourceFactory</code> use the
standard Java <code>ServiceLoader</code>.</p>
</div>
<div class="paragraph">
<p>For additional information, check out our documentation about
<a href="https://smallrye.io/docs/smallrye-config/config-sources/config-sources.html#_config_source_factory">Config Mappings</a> and
the example in the
<a href="https://github.com/smallrye/smallrye-config/tree/main/examples/configmap" class="bare">https://github.com/smallrye/smallrye-config/tree/main/examples/configmap</a> SmallRye Config Github repo.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="default_values">Default Values</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Right now, the only way to set a default value for a configuration to use the
<code>org.eclipse.microprofile.config.inject.ConfigProperty#defaultValue</code>. This has a few limitations. It doesn&#8217;t work in the
programmatic lookup or if we are using the annotation and have to inject the same property in multiple places,
we need to duplicate the default value in each injection point. Adding the configuration values into
<code>microprofile-config.properties</code> to act as a default is not optimal either, since they may override lower priority
custom sources.</p>
</div>
<div class="paragraph">
<p>SmallRye Config adds a simple API to set such default values, with
<code>SmallRyeConfigBuilder#withDefaultValue(String name, String value)</code> or
<code>SmallRyeConfigBuilder#withDefaultValue(Map&lt;String, String&gt; defaultValues)</code>.</p>
</div>
<div class="paragraph">
<p>Default values for any configuration name can then be supplied with these APIs. SmallRye Config will only fallback to
these default if no value is found in the available sources.</p>
</div>
<div class="paragraph">
<p>The Default values API also supports name patterns. For instance a <code>withDefaultValue("smallrye.*", "1234")</code> provides
default values for any configuration name with the prefix <code>smallrye</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary">Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All the new features detailed here are experimental. The team is happy with them, and they had careful consideration
when designed. We cannot guarantee that they won&#8217;t suffer any changes in the next few releases, especially considering
that the SmallRye team is also pushing to have these added to the MicroProfile Config specification, which may require
some changes.</p>
</div>
<div class="paragraph">
<p>This shouldn&#8217;t discourage developers to use these new features. We believe these add a lot of utility and improve the
developer experience when setting configurations in applications.</p>
</div>
<div class="paragraph">
<p>A handful of other small improvements and bugs fixes are also included in this release. Check them out in the
<a href="https://github.com/smallrye/smallrye-config/releases/tag/1.9.0">Release Notes</a></p>
</div>
<div class="paragraph">
<p>Please, feel free to drop us any feedback to the <a href="mailto:smallrye@googlegroups.com">SmallRye Mailing List</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="additional_resources">Additional Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/smallrye/smallrye-config/">GitHub Repository</a></p>
</li>
<li>
<p><a href="https://github.com/smallrye/smallrye-config/releases/tag/1.9.0">Release Notes</a></p>
</li>
<li>
<p><a href="https://smallrye.io/docs/smallrye-config/index.html">Documentation</a></p>
</li>
</ul>
</div>
</div>
</div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/smallrye_project_logo.svg" class="project-logo" title="SmallRye"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">SmallRye is open source under <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>. <br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/smallrye/smallrye.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="/">Home</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Contribute</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://twitter.com/smallrye_io">Follow us</a></li>
          
            <li><a href="https://github.com/smallrye">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://quarkusio.zulipchat.com">Chatroom</a></li>
          
            <li><a href="https://groups.google.com/d/forum/smallrye">Google&nbsp;Groups</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-6-12 more-links">
        <span>External Links</span>
        <ul class="footer-links">
          
            <li><a href="https://microprofile.io/" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://github.com/eclipse?utf8=✓&q=microprofile" target="_blank">Eclipse MicroProfile on GitHub</a></li>
          
        </ul>
      </div>
    
  </div>
</div>
  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a>
      | <a href="https://www.redhat.com/en/about/privacy-policy">Red Hat Privacy Policy</a>
    </span>
    <span class="redhat">
      a Red Hat sponsored project   
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script type="text/javascript" src="/assets/javascript/satellite.js"></script>
</body>

</html>
