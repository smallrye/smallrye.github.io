<!DOCTYPE html>
<html>

<head>
  <title>Jandex 3.1.0</title>
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlightjs-pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV="Content-Security-Policy" CONTENT="default-src 'none'; script-src 'self' www.redhat.com assets.adobedtm.com jsonip.com ajax.googleapis.com www.googletagmanager.com www.google-analytics.com use.fontawesome.com; style-src 'self'  fonts.googleapis.com use.fontawesome.com; img-src 'self' *; media-src 'self' ; frame-src www.googletagmanager.com; frame-ancestors 'none'; base-uri 'none'; object-src 'none'; form-action 'none'; font-src 'self' use.fontawesome.com fonts.gstatic.com;">
  <META HTTP-EQUIV="X-Frame-Options" CONTENT="DENY">
  <META HTTP-EQUIV="X-XSS-Protection" CONTENT="1; mode=block">
  <META HTTP-EQUIV="X-Content-Type-Options" CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="SmallRye is a project to share and collaborate on implementing specifications that are part of Eclipse MicroProfile.">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
</head>

<body class="post">

  <div class="content">
    <div class="navigation-wrapper">
  <div class="width-12-12">
    <div class="header navigation">
      <div class="logo-wrapper">
        <a href="/"><img class="project-logo" title="SmallRye" src="/assets/images/smallrye_project_logo.svg"></a>
      </div>
      <div class="nav-container">
        <nav>
          <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
          <ul class="nav-list">
            <li>
              <a href="/projects/" class="">Projects</a>
            </li>
            <li>
              <a href="/community/" class="">Community</a>
            </li>
            <li>
              <a href="/blog/" class="active">Blog</a>
            </li>
            <li>
              <a href="/docs/index.html" class="">Documentation</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>

    <div class="post-page grid-wrapper">
  <div class="grid__item width-10-12 doc-content">
    <h1>Jandex 3.1.0</h1>
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Today, we announce the <a href="https://github.com/smallrye/jandex/releases/tag/3.1.0">release</a> of Jandex 3.1.0.
It includes several improvements and bug fixes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="declarations">Declarations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The top-level interface in the Jandex object model has always been an <code>AnnotationTarget</code>: something that can be annotated.
There are generally two kinds of things that can be annotated, speaking in Java terms: declarations and types (or type usages, to be more precise).
This distinction hasn&#8217;t been reflected in the Jandex object model hierarchy, until now.</p>
</div>
<div class="paragraph">
<p>Jandex 3.1 adds the <code>Declaration</code> interface, which directly extends <code>AnnotationTarget</code>.
All classes that represent declarations now implement <code>Declaration</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ClassInfo</code></p>
</li>
<li>
<p><code>FieldInfo</code></p>
</li>
<li>
<p><code>MethodInfo</code></p>
</li>
<li>
<p><code>MethodParameterInfo</code></p>
</li>
<li>
<p><code>RecordComponentInfo</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The only <code>AnnotationTarget</code> that isn&#8217;t <code>Declaration</code> is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TypeTarget</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>EquivalenceKey</code> hierarchy also has a <code>DeclarationEquivalenceKey</code>, so that it corresponds to the <code>AnnotationTarget</code> hierarchy.</p>
</div>
<div class="paragraph">
<p>This is a small change that should significantly improve usage of Jandex as a language model.
It is very common to only care about annotated declarations, but for now, there hasn&#8217;t been a way to distinguish them from annotated type usages.
The <code>Declaration</code> interface serves this very purpose.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="factories_and_builders_for_types">Factories and builders for types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are different ways to instantiate a Jandex <code>Type</code>.
The <code>Type.create()</code> static method is not very easy to use, and the concrete subclasses of <code>Type</code> over time accumulated different static factory methods as well.</p>
</div>
<div class="paragraph">
<p>Jandex 3.1 adds a comprehensive set of static factory methods and builders to all complex <code>Type</code>s:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ClassType</code></p>
</li>
<li>
<p><code>ArrayType</code></p>
</li>
<li>
<p><code>ParameterizedType</code></p>
</li>
<li>
<p><code>TypeVariable</code></p>
</li>
<li>
<p><code>WildcardType</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All these classes have a set of static factory methods called <code>create()</code>, sufficient for the most common cases.
They also have a static method called <code>builder()</code> that returns a builder, usable for the less common cases, including type annotations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="array_types_representation">Array types representation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>ArrayType</code> class in Jandex models Java array types.
The Jandex representation, incidentally, is very different from the Java language representation, yet has always used the same terminology.</p>
</div>
<div class="paragraph">
<p>Quick refresher: in Java, array types have a component type and an element type.
For example, in case of <code>int[][]</code>, the element type is <code>int</code>, while the component type is <code>int[]</code> (whose component type is <code>int</code>).
In Jandex, <code>int[][]</code> has always been represented as a tuple: <code>{ componentType = int, dimensions = 2 }</code>.</p>
</div>
<div class="paragraph">
<p>This shows the first issue: conflicting terminology.
The term <em>component type</em> in Jandex has always meant something else than in Java.</p>
</div>
<div class="paragraph">
<p>That&#8217;s not everything, though.
To faithfully represent type annotations on the dimensions of the array, Jandex sometimes has to use an array type as the component type of an array type.
For example, the type <code>String[] @Ann []</code> has to be represented as an array with 1 dimension, whose component type is an array type <code>String @Ann []</code>.
The component type of that, in turn, is <code>String</code>.</p>
</div>
<div class="paragraph">
<p>As you can see, this is completely different from the Java representation.
This is usually not a big deal, because annotations on array dimensions are rare and multi-dimensional arrays are significantly less common than single-dimensional, but it still causes confusion.</p>
</div>
<div class="paragraph">
<p>With the release of Jandex 3.1, this is no more.</p>
</div>
<div class="paragraph">
<p>What Jandex used to call <em>component type</em> of an array is now named <em>constituent type</em>.
To access the Jandex representation, the following methods exist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>constituent()</code>: this method is new</p>
</li>
<li>
<p><code>dimensions()</code>: this method has existed before and hasn&#8217;t been changed to avoid breaking compatibility</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Methods to access the Java representation of array types are added:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>elementType()</code></p>
</li>
<li>
<p><code>componentType()</code></p>
</li>
<li>
<p><code>deepDimensions()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One method has been deprecated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>component()</code>: this method has existed before and hasn&#8217;t been changed to avoid breaking compatibility</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reconstructing_descriptors_and_generic_signatures">Reconstructing descriptors and generic signatures</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Advanced users of Jandex, such as Quarkus, sometimes have to reconstruct a descriptor or a generic signature of some Jandex object.
In this release, Jandex has this functionality built-in, accessible through two interfaces: <code>Descriptor</code> and <code>GenericSignature</code>.</p>
</div>
<div class="paragraph">
<p>Jandex classes that implement the <code>Descriptor</code> interface are able to reconstruct their bytecode descriptor.
Similarly, Jandex classes that implement the <code>GenericSignature</code> interface are able to reconstruct their generic signature and also return whether a generic signature is actually required.</p>
</div>
<div class="paragraph">
<p>Both descriptor and signature reconstruction can optionally perform type variable substitution.
That is, if a type variable occurs when reconstructing the descriptor, the corresponding part of the descriptor may instead describe another type returned by a given substitution function (same for signatures).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="other">Other</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Previously, Jandex used to fail when invalid generic signature occured in the indexed bytecode.
It turns out that ECJ may produce invalid generic signature on pretty basic code (synthetic static method generated for a lambda), so with Jandex 3.1, invalid signatures are simply ignored.
Thanks Hélios Gilles for providing a reproducer!</p>
</div>
<div class="paragraph">
<p>With great help from Francesco Nigro, a lot of performance improvements to the indexing process were made.
On large JARs, we&#8217;ve seen roughly 20% improvements in indexing speed and 50% improvements in allocation rate.
Thank you!</p>
</div>
<div class="paragraph">
<p>Finally, Brian Demers and Guillaume Nodet provided fixes for build reproducibility.
(Note that this is not an intentionally supported feature and it&#8217;s only maintained on a best effort basis.)
Thanks!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary">Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This release brings a lot of changes, but none of them break backward compatibility.
The persistent format of Jandex has not changed either, so upgrade should be safe for everyone.</p>
</div>
<div class="paragraph">
<p>If you experience any troubles, or if you have any ideas for Jandex improvements, please <a href="https://github.com/smallrye/jandex/issues">file an issue</a>.</p>
</div>
</div>
</div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/smallrye_project_logo.svg" class="project-logo" title="SmallRye"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">SmallRye is open source under <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>. <br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/smallrye/smallrye.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="/">Home</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Contribute</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://twitter.com/smallrye_io">Follow us</a></li>
          
            <li><a href="https://github.com/smallrye">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://quarkusio.zulipchat.com">Chatroom</a></li>
          
            <li><a href="https://groups.google.com/d/forum/smallrye">Google&nbsp;Groups</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-6-12 more-links">
        <span>External Links</span>
        <ul class="footer-links">
          
            <li><a href="https://microprofile.io/" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://github.com/eclipse?utf8=✓&q=microprofile" target="_blank">Eclipse MicroProfile on GitHub</a></li>
          
        </ul>
      </div>
    
  </div>
</div>
  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a>
      | <a href="https://www.redhat.com/en/about/privacy-policy">Red Hat Privacy Policy</a>
    </span>
    <span class="redhat">
      a Red Hat sponsored project   
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script type="text/javascript" src="/assets/javascript/satellite.js"></script>
</body>

</html>
