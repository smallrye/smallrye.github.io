<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Retry :: SmallRye documentation</title>
    <link rel="prev" href="timeout.html">
    <link rel="next" href="asynchronous.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <button class="nav-toggle"></button>

      <a class="navbar-item title" href="../index.html">SmallRye Fault Tolerance</a>

      <div class="navbar-item has-dropdown is-hoverable">
        <span class="navbar-link">6.4.0</span>
        <div class="navbar-dropdown navbar-menu">
            <a class="navbar-item " href="../../6.9.0/index.html">6.9.0</a>
            <a class="navbar-item " href="../../6.8.0/index.html">6.8.0</a>
            <a class="navbar-item " href="../../6.7.3/index.html">6.7.3</a>
            <a class="navbar-item " href="../../6.7.2/index.html">6.7.2</a>
            <a class="navbar-item " href="../../6.7.1/index.html">6.7.1</a>
            <a class="navbar-item " href="../../6.7.0/index.html">6.7.0</a>
            <a class="navbar-item " href="../../6.6.3/index.html">6.6.3</a>
            <a class="navbar-item " href="../../6.6.2/index.html">6.6.2</a>
            <a class="navbar-item " href="../../6.6.1/index.html">6.6.1</a>
            <a class="navbar-item " href="../../6.6.0/index.html">6.6.0</a>
            <a class="navbar-item " href="../../6.5.0/index.html">6.5.0</a>
            <a class="navbar-item " href="../../6.4.2/index.html">6.4.2</a>
            <a class="navbar-item " href="../../6.4.1/index.html">6.4.1</a>
            <a class="navbar-item  is-current" href="../index.html">6.4.0</a>
            <a class="navbar-item " href="../../6.3.0/index.html">6.3.0</a>
            <a class="navbar-item " href="../../6.2.6/index.html">6.2.6</a>
            <a class="navbar-item " href="../../6.2.4/index.html">6.2.4</a>
            <a class="navbar-item " href="../../6.2.3/index.html">6.2.3</a>
            <a class="navbar-item " href="../../6.2.2/index.html">6.2.2</a>
            <a class="navbar-item " href="../../6.2.1/index.html">6.2.1</a>
            <a class="navbar-item " href="../../6.2.0/index.html">6.2.0</a>
            <a class="navbar-item " href="../../6.1.0/index.html">6.1.0</a>
            <a class="navbar-item " href="../../6.0.0/index.html">6.0.0</a>
            <a class="navbar-item " href="../../5.6.0/index.html">5.6.0</a>
            <a class="navbar-item " href="../../5.5.0/index.html">5.5.0</a>
            <a class="navbar-item " href="../../5.4.1/index.html">5.4.1</a>
            <a class="navbar-item " href="../../5.4.0/index.html">5.4.0</a>
            <a class="navbar-item " href="../../5.3.2/index.html">5.3.2</a>
            <a class="navbar-item " href="../../5.3.1/index.html">5.3.1</a>
            <a class="navbar-item " href="../../5.3.0/index.html">5.3.0</a>
            <a class="navbar-item " href="../../5.2.1/index.html">5.2.1</a>
            <a class="navbar-item " href="../../5.2.0/index.html">5.2.0</a>
            <a class="navbar-item " href="../../5.1.0/index.html">5.1.0</a>
            <a class="navbar-item " href="../../5.0.0/index.html">5.0.0</a>
        </div>
      </div>


      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>

    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <span class="navbar-link">Projects</span>
          <div class="navbar-dropdown">
              <a class="navbar-item" href="../../../index/index/index.html">Index</a>
              <a class="navbar-item" href="../../6.9.0/index.html">SmallRye Fault Tolerance</a>
              <a class="navbar-item" href="../../../smallrye-health/3.0.1/index.html">SmallRye Health</a>
              <a class="navbar-item" href="../../../smallrye-jwt/index.html">SmallRye JWT</a>
              <a class="navbar-item" href="../../../smallrye-metrics/3.0.0/index.html">SmallRye Metrics</a>
          </div>
        </div>

        <a class="navbar-item" href="https://smallrye.io/">SmallRye.io main website</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="smallrye-fault-tolerance" data-version="6.4.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list nav-list-level-0">
  <li class="nav-item nav-item-level-0">
<ul class="nav-list nav-list-level-1">
  <li class="nav-item nav-item-level-1">
    <a class="nav-link" href="../index.html">Index</a>
  </li>
  <li class="nav-item nav-item-level-1">
    <span class="nav-text">How-to &#8230;&#8203;</span>
<ul class="nav-list nav-list-level-2">
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../howto/begin.html">Begin</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../howto/fallback.html">Supply Fallback Values</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../howto/bulkhead.html">Limit Concurrency</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../howto/circuit-breaker.html">Fail Fast on Recurring Failures</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../howto/timeout.html">Watch for Timeouts</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../howto/retry.html">Retry on Failures</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../howto/asynchronous.html">Guard Asynchronous Methods</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../howto/rate-limit.html">Limit Execution Rate</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../howto/multiple.html">Use Multiple Strategies</a>
  </li>
</ul>
  </li>
  <li class="nav-item nav-item-level-1">
    <span class="nav-text">Reference</span>
<ul class="nav-list nav-list-level-2">
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="fallback.html">Fallback</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="bulkhead.html">Bulkhead</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="circuit-breaker.html">Circuit Breaker</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="timeout.html">Timeout</a>
  </li>
  <li class="nav-item nav-item-level-2 is-current-page">
    <a class="nav-link" href="retry.html">Retry</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="asynchronous.html">Asynchronous Execution</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="rate-limit.html">Rate Limit</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="config.html">Configuration</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="metrics.html">Metrics</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="non-compat.html">Non-compatible Mode</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="programmatic-api.html">Programmatic API</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="reusable.html">Reusable Fault Tolerance</a>
  </li>
</ul>
  </li>
  <li class="nav-item nav-item-level-1">
    <span class="nav-text">Integration</span>
<ul class="nav-list nav-list-level-2">
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../integration/intro.html">Introduction</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../integration/metrics.html">Metrics</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../integration/thread-pool.html">Thread Pool</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../integration/context-propagation.html">Context Propagation</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../integration/opentracing.html">OpenTracing</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../integration/event-loop.html">Event Loop</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../integration/async-types.html">Additional Asynchronous Types Integration Concerns</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../integration/kotlin.html">Kotlin Integration Concerns</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../integration/programmatic-api.html">Programmatic API Integration Concerns</a>
  </li>
</ul>
  </li>
  <li class="nav-item nav-item-level-1">
    <span class="nav-text">Internals</span>
<ul class="nav-list nav-list-level-2">
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../internals/project-structure.html">Project Structure</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../internals/instructions.html">Instructions</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../internals/core.html">Fault Tolerance Core</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../internals/config.html">Configuration System</a>
  </li>
  <li class="nav-item nav-item-level-2">
    <a class="nav-link" href="../internals/logging.html">Logging</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
  <div class="content">
<aside class="toc sidebar" data-title="Table of contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
  <a href="https://github.com/smallrye/smallrye-fault-tolerance/blob/6.4.0/doc/modules/ROOT/pages/reference/retry.adoc" class="edit-this-page" title="Edit this page">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>
<h1 class="page">Retry</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>For introduction, see <a href="../howto/retry.html" class="page">How to Retry on Failures</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_description"><a class="anchor" href="#_description"></a>Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If a guarded method throws an exception, retry will swallow that exception and call the method again.</p>
</div>
<div class="paragraph">
<p>More specifically:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the guarded method returns normally, its return value is returned.</p>
</li>
<li>
<p>Otherwise, if the guarded method throws an exception whose type is assignable to any of the <code>abortOn</code> types (see <a href="#abort-on">abortOn</a>), retrying is aborted and the exception is rethrown.</p>
</li>
<li>
<p>Otherwise, if the guarded method throws an exception whose type is assignable to any of the <code>retryOn</code> types (see <a href="#retry-on">retryOn</a>), the method call is retried.</p>
</li>
<li>
<p>Otherwise, the exception is rethrown.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="interactions"><a class="anchor" href="#interactions"></a>Interactions with Other Strategies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>See <a href="../howto/multiple.html" class="page">How to Use Multiple Strategies</a> for an overview of how fault tolerance strategies are nested.</p>
</div>
<div class="paragraph">
<p>If <code>@Fallback</code> is used with <code>@Retry</code>, the fallback method or handler may be invoked if all retry attempts failed, depending on the fallback configuration.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="#configuration"></a>Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are 9 configuration options, corresponding to the 9 members of the <code>@Retry</code> annotation.</p>
</div>
<div class="sect2">
<h3 id="_maxretries"><a class="anchor" href="#_maxretries"></a><code>maxRetries</code></h3>
<div class="paragraph">
<p>Type: <code>int</code></p>
</div>
<div class="paragraph">
<p>Default: <code>3</code></p>
</div>
<div class="paragraph">
<p>The maximum number of retries.
<code>-1</code> means the maximum number of retries is unlimited.</p>
</div>
</div>
<div class="sect2">
<h3 id="_delay_delayunit"><a class="anchor" href="#_delay_delayunit"></a><code>delay</code> + <code>delayUnit</code></h3>
<div class="paragraph">
<p>Type: <code>long</code> + <code>ChronoUnit</code></p>
</div>
<div class="paragraph">
<p>Default: <code>0 millis</code></p>
</div>
<div class="paragraph">
<p>The delay between retry attempts.</p>
</div>
</div>
<div class="sect2">
<h3 id="_maxduration_durationunit"><a class="anchor" href="#_maxduration_durationunit"></a><code>maxDuration</code> + <code>durationUnit</code></h3>
<div class="paragraph">
<p>Type: <code>long</code> + <code>ChronoUnit</code></p>
</div>
<div class="paragraph">
<p>Default: <code>180_000 millis</code>, or 3 minutes</p>
</div>
<div class="paragraph">
<p>The maximum duration for which retries will be attempted.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note the naming inconsistency between <code>maxDuration</code> and <code>durationUnit</code>.
It is common for the time unit property to be named after the time value property, e.g. <code>maxDurationUnit</code>.
Fixing this inconsistency would be a breaking change the MicroProfile Fault Tolerance specification is not willing to make.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_jitter_jitterdelayunit"><a class="anchor" href="#_jitter_jitterdelayunit"></a><code>jitter</code> + <code>jitterDelayUnit</code></h3>
<div class="paragraph">
<p>Type: <code>long</code> + <code>ChronoUnit</code></p>
</div>
<div class="paragraph">
<p>Default: <code>200 millis</code></p>
</div>
<div class="paragraph">
<p>The maximum jitter to adjust the delay between retries.
If set, the delay before each retry attempt will be computed as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate random number from the closed interval <code>[-jitter, jitter]</code>.</p>
</li>
<li>
<p>Add the generated random number to the configured <code>delay</code>.</p>
</li>
<li>
<p>If the result is by any chance negative, use <code>0</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note the naming inconsistency between <code>jitter</code> and <code>jitterDelayUnit</code>.
It is common for the time unit property to be named after the time value property, e.g. <code>jitterUnit</code>.
Fixing this inconsistency would be a breaking change the MicroProfile Fault Tolerance specification is not willing to make.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="retry-on"><a class="anchor" href="#retry-on"></a><code>retryOn</code></h3>
<div class="paragraph">
<p>Type: <code>Class&lt;? extends Throwable&gt;[]</code></p>
</div>
<div class="paragraph">
<p>Default: <code>{Exception.class}</code></p>
</div>
<div class="paragraph">
<p>Set of exception types that trigger a retry.</p>
</div>
</div>
<div class="sect2">
<h3 id="abort-on"><a class="anchor" href="#abort-on"></a><code>abortOn</code></h3>
<div class="paragraph">
<p>Type: <code>Class&lt;? extends Throwable&gt;[]</code></p>
</div>
<div class="paragraph">
<p>Default: <code>{}</code></p>
</div>
<div class="paragraph">
<p>Set of exception types that abort retrying.
This configuration takes precedence over <code>retryOn</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="metrics"><a class="anchor" href="#metrics"></a>Metrics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Retry exposes the following metrics:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ft.retry.calls.total</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Counter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of times the retry logic was run. This will always be once per method call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tags</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>method</code> - the fully qualified method name</p>
</li>
<li>
<p><code>retried</code> = <code>[true|false]</code> - whether any retries occurred</p>
</li>
<li>
<p><code>retryResult</code> = <code>[valueReturned|exceptionNotRetryable|maxRetriesReached|maxDurationReached]</code> - the reason that last attempt to call the method was not retried</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ft.retry.retries.total</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Counter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of times the method was retried</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tags</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>method</code> - the fully qualified method name</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See <a href="metrics.html" class="page">the Metrics reference guide</a> for general metrics information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_extra_features"><a class="anchor" href="#_extra_features"></a>Extra Features</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_backoff_strategies_for_retry"><a class="anchor" href="#_backoff_strategies_for_retry"></a>Backoff Strategies for <code>@Retry</code></h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This is an additional feature of SmallRye Fault Tolerance and is not specified by MicroProfile Fault Tolerance.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When retrying failed operations, it is often useful to make a delay between retry attempts.
This delay is also called "backoff".
The <code>@Retry</code> annotation in MicroProfile Fault Tolerance supports a single backoff strategy: constant.
That is, the delay between all retry attempts is identical (except for a random jitter).</p>
</div>
<div class="paragraph">
<p>SmallRye Fault Tolerance offers 3 annotations to specify a different backoff strategy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@ExponentialBackoff</code></p>
</li>
<li>
<p><code>@FibonacciBackoff</code></p>
</li>
<li>
<p><code>@CustomBackoff</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One of these annotations may be present on any program element (method or class) that also has the <code>@Retry</code> annotation.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example;

@ApplicationScoped
public class MyService {
    @Retry
    @ExponentialBackoff
    public void hello() {
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is an error to add a backoff annotation to a program element that doesn&#8217;t have <code>@Retry</code> (e.g. add <code>@Retry</code> on a class and <code>@ExponentialBackoff</code> on a method).
It is also an error to add more than one of these annotations to the same program element.</p>
</div>
<div class="paragraph">
<p>When any one of these annotations is present, it modifies the behavior specified by the <code>@Retry</code> annotation.
The new behavior is as follows:</p>
</div>
<div class="paragraph">
<p>For <code>@ExponentialBackoff</code>, the delays between retry attempts grow exponentially, using a defined <code>factor</code>.
By default, the <code>factor</code> is 2, so each delay is 2 * the previous delay.
For example, if the initial delay (specified by <code>@Retry</code>) is 1 second, then the second delay is 2 seconds, third delay is 4 seconds, fourth delay is 8 seconds etc.
It is possible to define a <code>maxDelay</code>, so that this growth has a limit.</p>
</div>
<div class="paragraph">
<p>For <code>@FibonacciBackoff</code>, the delays between retry attempts grow per the Fibonacci sequence.
For example, if the initial delay (specified by <code>@Retry</code>) is 1 second, then the second delay is 2 seconds, third delay is 3 seconds, fourth delay is 5 seconds etc.
It is possible to define a <code>maxDelay</code>, so that this growth has a limit.</p>
</div>
<div class="paragraph">
<p>Both <code>@ExponentialBackoff</code> and <code>@FibonacciBackoff</code> also apply jitter, exactly like plain <code>@Retry</code>.</p>
</div>
<div class="paragraph">
<p>Also, since <code>@Retry</code> has a default <code>maxDuration</code> of 3 minutes and default <code>maxRetries</code> of 3, both <code>@ExponentialBackoff</code> and <code>@FibonacciBackoff</code> define a <code>maxDelay</code> of 1 minute.
If we redefine <code>maxRetries</code> to a much higher value, and the guarded method keeps failing, the delay would eventually become higher than 1 minute.
In that case, it will be limited to 1 minute.
Of course, <code>maxDelay</code> can be configured.
If set to <code>0</code>, there&#8217;s no limit, and the delays will grow without bounds.</p>
</div>
<div class="paragraph">
<p>For <code>@CustomBackoff</code>, computing the delays between retry attempts is delegated to a specified implementation of <code>CustomBackoffStrategy</code>.
This is an advanced option.</p>
</div>
<div class="paragraph">
<p>For more information about these backoff strategies, see the javadoc of the annotations.</p>
</div>
</div>
<div class="sect2">
<h3 id="_predicate_based_retry"><a class="anchor" href="#_predicate_based_retry"></a>Predicate-Based <code>@Retry</code></h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This is an additional feature of SmallRye Fault Tolerance and is not specified by MicroProfile Fault Tolerance.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, an operation is retried only if it fails and the exception is assignable to one of the classes defined in <code>@Retry.retryOn</code> (and not assignable to any of the classes defined in <code>@Retry.abortOn</code>).
With the <code>@RetryWhen</code> annotation, it is possible to instead define a custom predicate for the exception, as well as a predicate for the result.</p>
</div>
<div class="paragraph">
<p>The <code>@RetryWhen</code> annotation may be present on any program element (method or class) that also has the <code>@Retry</code> annotation.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example;

@ApplicationScoped
public class MyService {
    @Retry
    @RetryWhen(
        result = IsNull.class, <i class="conum" data-value="1"></i><b>(1)</b>
        exception = IsRuntimeException.class <i class="conum" data-value="2"></i><b>(2)</b>
    )
    public String hello() {
        ...
    }

    public static final class IsNull implements Predicate&lt;Object&gt; {
        @Override
        public boolean test(Object o) {
            return o == null;
        }
    }

    public static final class IsRuntimeException implements Predicate&lt;Throwable&gt; {
        @Override
        public boolean test(Throwable throwable) {
            return throwable instanceof RuntimeException;
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>When the method returns <code>null</code>, it will be retried.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>When the method throws a <code>RuntimeException</code>, it will be retried.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All other results are considered expected and are not retried.</p>
</div>
<div class="paragraph">
<p>It is an error to specify <code>@RetryWhen.exception</code> if <code>@Retry.retryOn</code> / <code>@Retry.abortOn</code> is specified.
Specifying <code>@RetryWhen.result</code> together with <code>@Retry.retryOn</code> / <code>@Retry.abortOn</code> is possible, although perhaps not the best idea.</p>
</div>
<div class="paragraph">
<p>It is an error to add a <code>@RetryWhen</code> annotation to a program element that doesn&#8217;t have <code>@Retry</code> (e.g. add <code>@Retry</code> on a class and <code>@RetryWhen</code> on a method).</p>
</div>
<div class="paragraph">
<p>For more information about <code>@RetryWhen</code>, see the javadoc of the annotation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_before_retry_actions"><a class="anchor" href="#_before_retry_actions"></a>Before Retry Actions</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This is an additional feature of SmallRye Fault Tolerance and is not specified by MicroProfile Fault Tolerance.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>@BeforeRetry</code> annotation supports specifying an action that should be performed before any retry.
The action will <em>not</em> be performed before the initial attempt.</p>
</div>
<div class="paragraph">
<p>The <code>@BeforeRetry</code> annotation may be present on any program element (method or class) that also has the <code>@Retry</code> annotation.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example;

@ApplicationScoped
public class MyService {
    @Retry
    @BeforeRetry(methodName = "beforeRetry") <i class="conum" data-value="1"></i><b>(1)</b>
    public String hello() {
        ...
    }

    public void beforeRetry() { <i class="conum" data-value="2"></i><b>(2)</b>
        ...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specifies that before retrying, the <code>beforeRetry</code> method should be called.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method must return <code>void</code> and have no parameters.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, it is possible to specify a class that is an implementation of the <code>BeforeRetryHandler</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example;

@ApplicationScoped
public class MyService {
    @Retry
    @BeforeRetry(MyBeforeRetry.class) <i class="conum" data-value="1"></i><b>(1)</b>
    public String hello() {
        ...
    }

    public static class MyBeforeRetry implements BeforeRetryHandler {
        public void handle(ExecutionContext context) {
            ...
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specifies that the <code>MyBeforeRetry</code> handler should be called before retrying.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is only possible to specify one option; specifying both <code>value</code> and <code>methodName</code> leads to a deployment problem.</p>
</div>
<div class="paragraph">
<p>Note that the before retry action must fast and non-blocking (i.e., it must not do any IO or long-running computations) and must not throw an exception.</p>
</div>
</div>
<div class="sect2">
<h3 id="inspecting-exception-cause-chains"><a class="anchor" href="#inspecting-exception-cause-chains"></a>Inspecting Exception Cause Chains</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This is an additional feature of SmallRye Fault Tolerance and is not specified by MicroProfile Fault Tolerance.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This feature only works in the <a href="non-compat.html" class="page">non-compatible mode</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>@Retry</code> annotation can specify that certain exceptions should be treated as failures (<code>retryOn</code>) and others as successes (<code>abortOn</code>).
The specification limits this to inspecting the actual exception that was thrown.
However, in many cases, exceptions are wrapped and the exception the user wants to decide on is only present in the cause chain.</p>
</div>
<div class="paragraph">
<p>For that reason, in the non-compatible mode, if the actual thrown exception isn&#8217;t known failure or known success, SmallRye Fault Tolerance inspects the cause chain.
To be specific, in case a <code>@Retry</code> method throws an exception, the decision process is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the <code>abortOn</code> exceptions are not default and the exception is assignable to one of the <code>abortOn</code> exceptions, retry is aborted and the exception is rethrown.</p>
</li>
<li>
<p>Otherwise, if the <code>retryOn</code> exceptions are not default and the exception is assignable to one of the <code>retryOn</code> exceptions, retry is attempted.</p>
</li>
<li>
<p>Otherwise, if the exception is assignable to one of the <code>abortOn</code> exceptions or its cause chain contains an exception assignable to one of the <code>abortOn</code> exceptions, retry is aborted and the exception is rethrown.</p>
</li>
<li>
<p>Otherwise, if the exception is assignable to one of the <code>retryOn</code> exceptions or its cause chain contains an exception assignable to one of the <code>retryOn</code> exceptions, retry is attempted.</p>
</li>
<li>
<p>Otherwise, the exception is rethrown.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Retry(maxRetries = 5,
    abortOn = ExpectedOutcomeException.class, <i class="conum" data-value="1"></i><b>(1)</b>
    retryOn = IOException.class) <i class="conum" data-value="2"></i><b>(2)</b>
public Result doSomething() {
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If <code>doSomething</code> throws an <code>ExpectedOutcomeException</code>, or a <code>WrapperException</code> whose cause is <code>ExpectedOutcomeException</code>, retry is aborted and the exception is thrown.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If <code>doSomething</code> throws an <code>IOException</code>, or a <code>WrapperException</code> whose cause is <code>IOException</code>, retry is attempted.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Retry(maxRetries = 5,
    abortOn = ExpectedOutcomeException.class) <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
public Result doSomething() {
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If <code>doSomething</code> throws an <code>ExpectedOutcomeException</code>, or a <code>WrapperException</code> whose cause is <code>ExpectedOutcomeException</code>, retry is aborted and the exception is thrown.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>There&#8217;s no <code>retryOn</code>, so the 2nd step in the algorithm above is skipped.
This is what turns the <code>WrapperException</code> whose cause is <code>ExpectedOutcomeException</code> into an aborted retry.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="timeout.html">Timeout</a></span>
  <span class="next"><a href="asynchronous.html">Asynchronous Execution</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>
    Sponsored by <a href="https://www.redhat.com"><img style="vertical-align: middle; height: 2.5em;" src="../../../_/img/redhat.svg" alt="Red Hat"></a>
  </p>
  <p>
    Made with <a href="https://github.com/smallrye/smallrye-antora-ui">SmallRye Antora UI</a>, which is licensed under the MPL-2.0 license.
    Includes portions of <a href="https://squidfunk.github.io/mkdocs-material/">Material for MkDocs</a>, which is licensed under the MIT license.
  </p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
