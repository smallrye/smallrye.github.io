<!DOCTYPE html>
<html>

<head>
  <title>Fault Tolerance 5.4</title>
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlightjs-pack.js" type="text/javascript"></script>
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      https://www.redhat.com
      https://static.redhat.com
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://www.google-analytics.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <META HTTP-EQUIV="X-Frame-Options" CONTENT="DENY">
  <META HTTP-EQUIV="X-XSS-Protection" CONTENT="1; mode=block">
  <META HTTP-EQUIV="X-Content-Type-Options" CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="SmallRye is a project to share and collaborate on implementing specifications that are part of Eclipse MicroProfile.">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
</head>

<body class="post">

  <div class="content">
    <div class="navigation-wrapper">
  <div class="width-12-12">
    <div class="header navigation">
      <div class="logo-wrapper">
        <a href="/"><img class="project-logo" title="SmallRye" src="/assets/images/smallrye_project_logo.svg"></a>
      </div>
      <div class="nav-container">
        <nav>
          <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
          <ul class="nav-list">
            <li>
              <a href="/projects/" class="">Projects</a>
            </li>
            <li>
              <a href="/community/" class="">Community</a>
            </li>
            <li>
              <a href="/blog/" class="active">Blog</a>
            </li>
            <li>
              <a href="/docs/index.html" class="">Documentation</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>

    <div class="post-page grid-wrapper">
  <div class="grid__item width-10-12 doc-content">
    <h1>Fault Tolerance 5.4</h1>
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Today, we announce the <a href="https://github.com/smallrye/smallrye-fault-tolerance/releases/tag/5.4.0">release</a> of SmallRye Fault Tolerance 5.4.0.
This release includes several new features and fixes related to the programmatic API.
It should be a safe upgrade for everyone using SmallRye Fault Tolerance 5.3.x.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reusable_preconfigured_fault_tolerance_strategies">Reusable, preconfigured fault tolerance strategies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In SmallRye Fault Tolerance 5.3.0, we <a href="/blog/fault-tolerance-5-3/">introduced</a> the programmatic API.
In this release, we augment that with a declarative way of applying programmatically created fault tolerance!
This allows centralizing fault tolerance configuration, as well as sharing fault tolerance state, all in a nice declarative fashion consistent with MicroProfile Fault Tolerance.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s demonstrate it with an example.
First, you have to create a bean of type <code>FaultTolerance</code> with an <code>@Identifier</code> qualifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@ApplicationScoped
public class PreconfiguredFaultTolerance {
    @Produces
    @Identifier("my-fault-tolerance")
    public static final FaultTolerance&lt;String&gt; FT = FaultTolerance.&lt;String&gt;create()
            .withRetry().maxRetries(2).done()
            .withFallback().handler(() -&gt; "fallback").done()
            .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is customary to create the bean by declaring a <code>static</code> producer field, which is what we&#8217;ve done here.</p>
</div>
<div class="paragraph">
<p>Once we have that, we can apply <code>my-fault-tolerance</code> to synchronous methods that return <code>String</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@ApplicationScoped
public class MyService {
    @ApplyFaultTolerance("my-fault-tolerance")
    public String doSomething() {
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://smallrye.io/docs/smallrye-fault-tolerance/5.4.0/usage/extra.html#_reusable_preconfigured_fault_tolerance">documentation</a> for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exception_decisions_in_programmatic_api">Exception decisions in programmatic API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The circuit breaker, fallback, and retry fault tolerance strategies allow configuring what happens on certain exceptions.
Both the declarative and programmatic API allow configuring a set of exception classes that are considered expected and unexpected.</p>
</div>
<div class="paragraph">
<p>With this release, the programmatic API also lets you supply a simple exception predicate, which allows expressing more complex exception decisions.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Callable&lt;String&gt; guarded = FaultTolerance.createCallable(this::action)
        .withFallback().handler(this::fallback).when(e -&gt; e instanceof RuntimeException).done()
        .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, the value of this approach is that the predicate may be more complex than a simple <code>instanceof</code> check.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="support_for_kotlin_suspending_functions">Support for Kotlin suspending functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SmallRye Fault Tolerance already supports some asynchronous types on top of the <code>CompletionStage</code> type mandated by the MicroProfile Fault Tolerance specification.
Specifically, there&#8217;s support for Mutiny and RxJava 3 and more could easily be added if needed.</p>
</div>
<div class="paragraph">
<p>In this release of SmallRye Fault Tolerance, a new module <code>smallrye-fault-tolerance-kotlin</code> is added that provides support for Kotlin <code>suspend</code> functions.
They are also considered asynchronous, so fault tolerance applies across suspension points, like you&#8217;d expect.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@ApplicationScoped
open class MyService {
    @Retry(maxRetries = 2)
    @Fallback(fallbackMethod = "helloFallback")
    open suspend fun hello(): String {
        delay(100)
        throw IllegalArgumentException()
    }

    private suspend fun helloFallback(): String {
        delay(100)
        return "hello"
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="others">Others</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The SmallRye Fault Tolerance documentation of the programmatic API recommends to store <code>FaultTolerance</code> instances into <code>static</code> fields.
This has some interesting implications.
Specifically, the entire fault tolerance chain is built in the static initializer, and that includes looking up several beans from the CDI container and possibly even creating a thread.
That is problematic in Quarkus when compiling to a native image, because static initialization code is executed during native image build.</p>
</div>
<div class="paragraph">
<p>In this release of SmallRye Fault Tolerance, this problem is fixed.
Almost all of the initialization is deferred to runtime.</p>
</div>
<div class="paragraph">
<p>All in all, upgrading to 5.4.0 is very much recommended.
As described above, there are certain new things, so if you encounter any bugs, please let us know in the <a href="https://github.com/smallrye/smallrye-fault-tolerance/issues">issue tracker</a>!
We&#8217;re still very much interested in any feedback on the programmatic API.</p>
</div>
</div>
</div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/smallrye_project_logo.svg" class="project-logo" title="SmallRye"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">SmallRye is open source under <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>. <br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/smallrye/smallrye.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="/">Home</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Contribute</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://twitter.com/smallrye_io">Follow us</a></li>
          
            <li><a href="https://github.com/smallrye">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://quarkusio.zulipchat.com">Chatroom</a></li>
          
            <li><a href="https://groups.google.com/d/forum/smallrye">Google&nbsp;Groups</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-6-12 more-links">
        <span>External Links</span>
        <ul class="footer-links">
          
            <li><a href="https://microprofile.io/" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://github.com/eclipse?utf8=✓&q=microprofile" target="_blank">Eclipse MicroProfile on GitHub</a></li>
          
        </ul>
      </div>
    
  </div>
</div>
  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a>
      | <a href="https://www.redhat.com/en/about/privacy-policy">Red Hat Privacy Policy</a>
    </span>
    <span class="redhat">
      a Red Hat sponsored project   
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script type="text/javascript" src="/assets/javascript/satellite.js"></script>
</body>

</html>
